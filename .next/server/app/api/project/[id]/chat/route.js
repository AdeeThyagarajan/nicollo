"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/project/[id]/chat/route";
exports.ids = ["app/api/project/[id]/chat/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute&page=%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute.ts&appDir=%2FUsers%2Fadhiththyagarajan%2FDesktop%2FNicollo%2Fnicollo%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fadhiththyagarajan%2FDesktop%2FNicollo%2Fnicollo&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute&page=%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute.ts&appDir=%2FUsers%2Fadhiththyagarajan%2FDesktop%2FNicollo%2Fnicollo%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fadhiththyagarajan%2FDesktop%2FNicollo%2Fnicollo&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_adhiththyagarajan_Desktop_Nicollo_nicollo_app_api_project_id_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/project/[id]/chat/route.ts */ \"(rsc)/./app/api/project/[id]/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/project/[id]/chat/route\",\n        pathname: \"/api/project/[id]/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/project/[id]/chat/route\"\n    },\n    resolvedPagePath: \"/Users/adhiththyagarajan/Desktop/Nicollo/nicollo/app/api/project/[id]/chat/route.ts\",\n    nextConfigOutput,\n    userland: _Users_adhiththyagarajan_Desktop_Nicollo_nicollo_app_api_project_id_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/project/[id]/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwcm9qZWN0JTJGJTVCaWQlNUQlMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZwcm9qZWN0JTJGJTVCaWQlNUQlMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGcHJvamVjdCUyRiU1QmlkJTVEJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmFkaGl0aHRoeWFnYXJhamFuJTJGRGVza3RvcCUyRk5pY29sbG8lMkZuaWNvbGxvJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmFkaGl0aHRoeWFnYXJhamFuJTJGRGVza3RvcCUyRk5pY29sbG8lMkZuaWNvbGxvJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNtQztBQUNoSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL25pY29sbG8tdjEvPzYyNjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2FkaGl0aHRoeWFnYXJhamFuL0Rlc2t0b3AvTmljb2xsby9uaWNvbGxvL2FwcC9hcGkvcHJvamVjdC9baWRdL2NoYXQvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3Byb2plY3QvW2lkXS9jaGF0L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcHJvamVjdC9baWRdL2NoYXRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3Byb2plY3QvW2lkXS9jaGF0L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2FkaGl0aHRoeWFnYXJhamFuL0Rlc2t0b3AvTmljb2xsby9uaWNvbGxvL2FwcC9hcGkvcHJvamVjdC9baWRdL2NoYXQvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3Byb2plY3QvW2lkXS9jaGF0L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute&page=%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute.ts&appDir=%2FUsers%2Fadhiththyagarajan%2FDesktop%2FNicollo%2Fnicollo%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fadhiththyagarajan%2FDesktop%2FNicollo%2Fnicollo&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/project/[id]/chat/route.ts":
/*!********************************************!*\
  !*** ./app/api/project/[id]/chat/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/sandbox/chatStore */ \"(rsc)/./lib/sandbox/chatStore.ts\");\n/* harmony import */ var _lib_sandbox_fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/sandbox/fs */ \"(rsc)/./lib/sandbox/fs.ts\");\n/* harmony import */ var _lib_ai_generateFiles__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/ai/generateFiles */ \"(rsc)/./lib/ai/generateFiles.ts\");\n/* harmony import */ var _lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/sandbox/meta */ \"(rsc)/./lib/sandbox/meta.ts\");\n// app/api/project/[id]/chat/route.ts\n\n\n\n\n\n\n\nconst runtime = \"nodejs\";\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_6__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nfunction uid() {\n    return crypto__WEBPACK_IMPORTED_MODULE_1___default().randomUUID();\n}\nfunction safeTrim(s) {\n    return typeof s === \"string\" ? s.trim() : \"\";\n}\nfunction sanitizeAssistantMessage(msg, fallback) {\n    const t = typeof msg === \"string\" ? msg.trim() : \"\";\n    if (!t) return fallback;\n    const hasFence = t.includes(\"```\");\n    const hasFileHeader = /^---\\s+.+\\s+---/m.test(t);\n    const codeyLines = (t.match(/^\\s*(import\\s+|export\\s+|const\\s+|function\\s+|class\\s+|<\\w+|{\\s*$)/gm) || []).length;\n    if (hasFence || hasFileHeader || codeyLines >= 3 || t.length > 900) return fallback;\n    const withoutFences = t.replace(/```[\\s\\S]*?```/g, \"\").trim();\n    return withoutFences || fallback;\n}\n/**\n * PLATFORM INFERENCE (no technical questions upfront)\n * - infer from first prompt\n * - if unclear, ask ONE simple question (then default to web if still unclear)\n */ function inferPlatform(text) {\n    const t = (text || \"\").toLowerCase();\n    const hasWeb = /\\b(web|website|saas|dashboard|landing page|next\\.?js|browser)\\b/.test(t);\n    const hasIOS = /\\b(ios|iphone|ipad|apple)\\b/.test(t);\n    const hasAndroid = /\\b(android)\\b/.test(t);\n    if (hasIOS && hasAndroid) return \"ios_android\";\n    if (hasIOS) return \"ios\";\n    if (hasAndroid) return \"android\";\n    if (hasWeb) return \"web\";\n    // If they say \"app\" but don’t specify platform, it’s unclear -> ask once.\n    if (/\\bapp\\b/.test(t)) return null;\n    return null;\n}\nfunction parsePlatformAnswer(text) {\n    const t = (text || \"\").toLowerCase();\n    if (/\\b(both|ios and android|iphone and android|android and iphone)\\b/.test(t)) return \"ios_android\";\n    if (/\\b(web|website|browser|saas)\\b/.test(t)) return \"web\";\n    if (/\\b(ios|iphone|ipad|apple)\\b/.test(t)) return \"ios\";\n    if (/\\b(android)\\b/.test(t)) return \"android\";\n    return null;\n}\n/**\n * Default platform → language → framework rules (LOCKED)\n */ function buildInfoDefaults(platform) {\n    if (platform === \"web\") {\n        return {\n            platform,\n            framework: \"nextjs\",\n            language: \"javascript\"\n        };\n    }\n    if (platform === \"ios_android\") {\n        return {\n            platform,\n            framework: \"shared_mobile\",\n            language: \"javascript\"\n        };\n    }\n    if (platform === \"ios\") {\n        return {\n            platform,\n            framework: \"swift\",\n            language: \"swift\"\n        };\n    }\n    return {\n        platform,\n        framework: \"kotlin\",\n        language: \"kotlin\"\n    };\n}\nfunction isImageRequest(text) {\n    const t = text.toLowerCase();\n    return t.includes(\"mockup\") || t.includes(\"wireframe\") || t.includes(\"ui design\") || t.includes(\"ui mockup\") || t.includes(\"design image\") || t.includes(\"screen design\") || t.includes(\"dashboard ui\") || t.includes(\"create a ui\") || t.includes(\"ui image\") || t.includes(\"mock up\") // IMPORTANT: catch \"mock up\" too\n    ;\n}\nfunction isBuildRequest(text) {\n    const t = text.toLowerCase();\n    // Explicit build verbs\n    if (t.includes(\"build\") || t.includes(\"create an app\") || t.includes(\"create a project\") || t.includes(\"generate code\") || t.includes(\"write code\") || t.includes(\"set up\") || t.includes(\"implement\") || t.includes(\"update the app\") || t.includes(\"modify the app\") || t.includes(\"change the app\")) {\n        return true;\n    }\n    // \"Builder-ish\" phrasing that users commonly use.\n    if (t.includes(\"create a\") || t.includes(\"add a\") || t.includes(\"make this\") || t.includes(\"app that\")) {\n        return true;\n    }\n    // If the user is clearly describing an app spec (platform/framework + requirements),\n    // treat it as a build request even if they didn't say \"build\".\n    // This fixes cases like: \"It is an app for both android and iOS. use openweathermap...\"\n    const mentionsPlatformOrStack = /\\b(it is|it's)\\s+(an?\\s+)?app\\b/.test(t) || /\\b(ios|android|iphone|ipad|react\\s*native|expo|next\\.?js|web app|saas)\\b/.test(t);\n    const requirementHits = (t.match(/\\b(use|support|include|should|must|need|with|add)\\b/g) || []).length;\n    const hasFileOrCodeSignals = /\\b(readme|package\\.json|app\\.js|index\\.html|src\\/|\\.env|endpoint|api key)\\b/.test(t);\n    if (mentionsPlatformOrStack && requirementHits >= 2 || hasFileOrCodeSignals) return true;\n    return false;\n}\n/**\n * Keep any file that has a path; allow empty content too (still creates a file).\n * This prevents \"no files written\" when the model returns an empty string for some files.\n */ function normalizeFiles(files) {\n    if (!Array.isArray(files)) return [];\n    const out = [];\n    for (const f of files){\n        if (!f) continue;\n        const path = typeof f.path === \"string\" ? f.path.trim() : \"\";\n        const content = typeof f.content === \"string\" ? f.content : \"\";\n        if (!path) continue;\n        // prevent weird absolute paths\n        const safePath = path.replace(/^(\\.\\.\\/)+/g, \"\").replace(/^\\/+/, \"\");\n        out.push({\n            path: safePath,\n            content\n        });\n    }\n    // de-dupe by path (last one wins)\n    const byPath = new Map();\n    for (const f of out)byPath.set(f.path, f);\n    return Array.from(byPath.values());\n}\n/**\n * Hard guarantee: if the model returns no files, we still create a real scaffold.\n * This prevents the “toy/dummy” feel and guarantees the project folder is never empty.\n */ function fallbackScaffold(userPrompt) {\n    return [\n        {\n            path: \"README.md\",\n            content: `# Devassist Project\n\n## Goal\n${userPrompt}\n\n## What you got\n- A real file scaffold written into the project folder (even if some runtime features are limited in sandbox)\n- A working local proxy example for real-time Places data (CORS-safe + hides API key)\n- A simple frontend that calls the proxy\n\n## Real-time restaurants (important)\nBrowser calls to Google Places Web Service endpoints often fail due to CORS and expose your API key.\nUse the included proxy (\\`server/proxy.js\\`) and keep the key in \\`.env\\`.\n\n## Run\n1) Copy env:\n   - cp .env.example .env\n   - set GOOGLE_PLACES_API_KEY\n\n2) Start proxy:\n   - node server/proxy.js\n\n3) Serve frontend locally:\n   - python -m http.server 5173\n   - open http://localhost:5173\n\n`\n        },\n        {\n            path: \".env.example\",\n            content: `# DO NOT COMMIT REAL KEYS\n\nGOOGLE_PLACES_API_KEY=YOUR_KEY_HERE\nPORT=8787\n`\n        },\n        {\n            path: \"server/proxy.js\",\n            content: `/**\n * Minimal Node proxy for Google Places Web Service (avoids CORS + hides API key).\n * Run: node server/proxy.js\n * Frontend calls: http://localhost:8787/api/places/nearby?... and /api/places/details?placeId=...\n *\n * NOTE:\n * - Requires Node 18+ (global fetch)\n * - This is intentionally minimal; add rate limiting + caching for production.\n */\nimport http from \"http\";\nimport { URL } from \"url\";\n\nconst PORT = Number(process.env.PORT || 8787);\nconst API_KEY = process.env.GOOGLE_PLACES_API_KEY;\n\nif (!API_KEY) {\n  console.error(\"Missing GOOGLE_PLACES_API_KEY. Create a .env file from .env.example\");\n  process.exit(1);\n}\n\nfunction sendJson(res, status, obj) {\n  res.writeHead(status, {\n    \"content-type\": \"application/json; charset=utf-8\",\n    \"access-control-allow-origin\": \"*\",\n    \"access-control-allow-methods\": \"GET,OPTIONS\",\n    \"access-control-allow-headers\": \"content-type\",\n  });\n  res.end(JSON.stringify(obj));\n}\n\nfunction send(res, status, text) {\n  res.writeHead(status, {\n    \"content-type\": \"text/plain; charset=utf-8\",\n    \"access-control-allow-origin\": \"*\",\n    \"access-control-allow-methods\": \"GET,OPTIONS\",\n    \"access-control-allow-headers\": \"content-type\",\n  });\n  res.end(text);\n}\n\nconst server = http.createServer(async (req, res) => {\n  if (req.method === \"OPTIONS\") return send(res, 204, \"\");\n  if (req.method !== \"GET\") return send(res, 405, \"method not allowed\");\n\n  const url = new URL(req.url, \"http://localhost\");\n  if (url.pathname === \"/api/places/nearby\") {\n    const lat = url.searchParams.get(\"lat\");\n    const lng = url.searchParams.get(\"lng\");\n    const radius = url.searchParams.get(\"radius\") || \"1500\";\n    const keyword = url.searchParams.get(\"keyword\") || \"restaurant\";\n\n    if (!lat || !lng) return sendJson(res, 400, { error: \"lat,lng required\" });\n\n    const upstream = new URL(\"https://maps.googleapis.com/maps/api/place/nearbysearch/json\");\n    // ✅ FIX: escape template vars inside THIS TypeScript template string\n    upstream.searchParams.set(\"location\", lat + \",\" + lng);\n    upstream.searchParams.set(\"radius\", radius);\n    upstream.searchParams.set(\"keyword\", keyword);\n    upstream.searchParams.set(\"key\", API_KEY);\n\n    try {\n      const r = await fetch(upstream.toString());\n      const j = await r.json();\n      return sendJson(res, 200, j);\n    } catch (e) {\n      return sendJson(res, 500, { error: \"upstream fetch failed\" });\n    }\n  }\n\n  if (url.pathname === \"/api/places/details\") {\n    const placeId = url.searchParams.get(\"placeId\");\n    if (!placeId) return sendJson(res, 400, { error: \"placeId required\" });\n\n    const upstream = new URL(\"https://maps.googleapis.com/maps/api/place/details/json\");\n    upstream.searchParams.set(\"place_id\", placeId);\n    upstream.searchParams.set(\"fields\", \"name,formatted_address,rating,opening_hours,website,formatted_phone_number,photos\");\n    upstream.searchParams.set(\"key\", API_KEY);\n\n    try {\n      const r = await fetch(upstream.toString());\n      const j = await r.json();\n      return sendJson(res, 200, j);\n    } catch (e) {\n      return sendJson(res, 500, { error: \"upstream fetch failed\" });\n    }\n  }\n\n  return send(res, 404, \"not found\");\n});\n\nserver.listen(PORT, () => {\n  console.log(\"Proxy listening on\", PORT);\n});\n`\n        }\n    ];\n}\nasync function summarizeForMemory(history) {\n    try {\n        const trimmed = history.slice(-40);\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-5.2\",\n            temperature: 0.2,\n            messages: [\n                {\n                    role: \"system\",\n                    content: \"Summarize the project conversation into a short, factual memory for future iterations. \" + \"Capture goals, chosen stack/platform, key decisions, and what has been built so far. \" + \"No fluff. Return plain text only.\"\n                },\n                {\n                    role: \"user\",\n                    content: trimmed.map((m)=>`${m.role.toUpperCase()}: ${m.content}`).join(\"\\n\")\n                }\n            ]\n        });\n        return completion.choices?.[0]?.message?.content?.trim() || \"\";\n    } catch  {\n        return \"\";\n    }\n}\nasync function updateRollingMemory(projectId) {\n    const meta = (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.readMeta)(projectId) || {\n        id: projectId\n    };\n    const history = (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.readChat)(projectId, 120);\n    const memory = await summarizeForMemory(history);\n    try {\n        if (memory) {\n            const next = {\n                ...meta,\n                memory,\n                updatedAt: new Date().toISOString()\n            };\n            (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.writeMeta)(projectId, next);\n            return next;\n        }\n    } catch  {\n    // don’t break app if summarization fails\n    }\n    return meta;\n}\nfunction saveGeneratedImageToMeta(projectId, image) {\n    const meta = (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.readMeta)(projectId) || {\n        id: projectId\n    };\n    const images = Array.isArray(meta.images) ? meta.images : [];\n    const nextImage = {\n        id: uid(),\n        createdAt: new Date().toISOString(),\n        prompt: image.prompt || \"\",\n        ...image.url ? {\n            url: image.url\n        } : {},\n        ...image.dataUrl ? {\n            dataUrl: image.dataUrl\n        } : {}\n    };\n    const next = {\n        ...meta,\n        images: [\n            nextImage,\n            ...images\n        ].slice(0, 20),\n        lastImage: nextImage,\n        updatedAt: new Date().toISOString()\n    };\n    (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.writeMeta)(projectId, next);\n}\nasync function GET(_req, { params }) {\n    try {\n        const projectId = params.id;\n        // Return the most recent turns for hydration on reload.\n        // chatStore items are expected to be: { role, content, imageUrl?, imageDataUrl? }\n        const turns = (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.readChat)(projectId, 200).map((t)=>({\n                role: t.role,\n                content: t.content,\n                ...t.imageUrl ? {\n                    imageUrl: t.imageUrl\n                } : {},\n                ...t.imageDataUrl ? {\n                    imageDataUrl: t.imageDataUrl\n                } : {}\n            }));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            turns\n        });\n    } catch (err) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: false,\n            error: err?.message ? String(err.message) : \"Failed to load chat\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function POST(req, { params }) {\n    try {\n        const body = await req.json();\n        const message = typeof body.message === \"string\" ? body.message : body.message?.text;\n        if (!message || typeof message !== \"string\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                ok: false,\n                error: \"Invalid message payload\"\n            });\n        }\n        const projectId = params.id;\n        // Persist user message (this matches your working chatStore shape)\n        (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.appendChat)(projectId, {\n            role: \"user\",\n            content: message\n        });\n        // ---- PLATFORM INFERENCE + BUILD INFO (one question max) ----\n        const metaAtStart = (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.readMeta)(projectId) || {\n            id: projectId\n        };\n        const pendingPrompt = safeTrim(metaAtStart.pendingPlatformPrompt);\n        if (!metaAtStart.buildInfo) {\n            if (pendingPrompt) {\n                // They are answering the one clarification question\n                const p = parsePlatformAnswer(message);\n                const resolved = p ?? \"web\"; // ask once; default to web if still unclear\n                const d = buildInfoDefaults(resolved);\n                const appName = safeTrim(metaAtStart.title) || `Project ${projectId}`;\n                const oneLiner = safeTrim(pendingPrompt).slice(0, 140) || \"App build in progress.\";\n                (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.writeMeta)(projectId, {\n                    ...metaAtStart,\n                    pendingPlatformPrompt: undefined,\n                    buildInfo: {\n                        ...d,\n                        appName,\n                        oneLiner,\n                        coreFeatures: []\n                    }\n                });\n            } else {\n                const inferred = inferPlatform(message);\n                if (!inferred) {\n                    const question = \"Is this a web app, an iPhone app, an Android app, or both iPhone and Android?\";\n                    (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.writeMeta)(projectId, {\n                        ...metaAtStart,\n                        pendingPlatformPrompt: message\n                    });\n                    (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.appendChat)(projectId, {\n                        role: \"assistant\",\n                        content: question\n                    });\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        ok: true,\n                        type: \"text\",\n                        reply: question\n                    });\n                }\n                const d = buildInfoDefaults(inferred);\n                const appName = safeTrim(metaAtStart.title) || `Project ${projectId}`;\n                const oneLiner = safeTrim(message).slice(0, 140) || \"App build in progress.\";\n                (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.writeMeta)(projectId, {\n                    ...metaAtStart,\n                    buildInfo: {\n                        ...d,\n                        appName,\n                        oneLiner,\n                        coreFeatures: []\n                    }\n                });\n            }\n        }\n        /**\n     * IMAGE MODE (FIXED)\n     * - No unsupported params (no response_format)\n     * - Returns url OR dataUrl\n     * - DOES NOT store huge data URLs in chat history (prevents the UI printing base64 blobs)\n     * - Stores images in meta.images / meta.lastImage instead\n     */ if (isImageRequest(message)) {\n            try {\n                const image = await openai.images.generate({\n                    model: \"gpt-image-1\",\n                    prompt: `\nYou are a senior product designer.\n\nCreate a high-fidelity, modern SaaS UI mockup based on this request:\n\n${message}\n\nConstraints:\n- realistic product UI\n- clean typography\n- neutral background\n- professional SaaS style\n`,\n                    size: \"1024x1024\"\n                });\n                const first = image?.data?.[0];\n                const imageUrl = first?.url ? String(first.url) : \"\";\n                const b64 = first?.b64_json ? String(first.b64_json) : \"\";\n                const imageDataUrl = b64 ? `data:image/png;base64,${b64}` : \"\";\n                if (!imageUrl && !imageDataUrl) {\n                    const errMsg = \"Image generation returned no url or base64\";\n                    (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.appendChat)(projectId, {\n                        role: \"assistant\",\n                        content: errMsg\n                    });\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        ok: false,\n                        error: errMsg\n                    });\n                }\n                // Save the actual image payload in meta, NOT as a chat bubble string.\n                saveGeneratedImageToMeta(projectId, {\n                    url: imageUrl || undefined,\n                    dataUrl: imageDataUrl || undefined,\n                    prompt: message\n                });\n                // Chat bubble stays readable (no base64 dump)\n                const friendly = \"Mockup image generated.\";\n                (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.appendChat)(projectId, {\n                    role: \"assistant\",\n                    content: friendly\n                });\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    ok: true,\n                    type: \"image\",\n                    reply: friendly,\n                    ...imageUrl ? {\n                        imageUrl\n                    } : {},\n                    ...!imageUrl && imageDataUrl ? {\n                        imageDataUrl\n                    } : {}\n                });\n            } catch (err) {\n                const msg = err?.message || \"Image generation error\";\n                (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.appendChat)(projectId, {\n                    role: \"assistant\",\n                    content: msg\n                });\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    ok: false,\n                    error: msg\n                });\n            }\n        }\n        // BUILD MODE\n        if (isBuildRequest(message)) {\n            // keep memory updated so builds stack cleanly\n            const metaBefore = await updateRollingMemory(projectId);\n            const memory = typeof metaBefore.memory === \"string\" ? metaBefore.memory : \"\";\n            const history = (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.readChat)(projectId, 80);\n            // context shape kept as you had it (role + text)\n            const context = history.map((m)=>({\n                    role: m.role,\n                    text: m.content\n                }));\n            // ✅ Read the current project files from disk and feed them into the builder\n            const existingPaths = (0,_lib_sandbox_fs__WEBPACK_IMPORTED_MODULE_3__.listFiles)(projectId).slice(0, 200); // cap to avoid huge prompts\n            const existingFiles = (0,_lib_sandbox_fs__WEBPACK_IMPORTED_MODULE_3__.readFilesSnapshot)(projectId, existingPaths, 120000);\n            // Build Info passed into generator (source of truth)\n            const metaForBuild = (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.readMeta)(projectId) || {};\n            const buildInfo = metaForBuild.buildInfo || null;\n            const result = await (0,_lib_ai_generateFiles__WEBPACK_IMPORTED_MODULE_4__.generateFiles)({\n                userMessage: message,\n                context,\n                existingFiles,\n                buildInfo,\n                instructions: `\nYou MUST return a non-empty list of files to write to the project folder.\nYou MUST build on the CURRENT PROJECT FILES provided (do not reset unless explicitly asked).\nIf external services are needed (real-time restaurants, maps, auth, payments):\n- still generate the full scaffold (frontend + backend/proxy + env template + README)\n- do not refuse due to sandbox runtime limitations\n\nProject memory (authoritative):\n${memory || \"(none)\"}\n\nBuild Info (source of truth; MUST obey):\n${buildInfo ? JSON.stringify(buildInfo, null, 2) : \"(not set yet)\"}\n`\n            });\n            if (!result?.ok) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    ok: false,\n                    error: result?.reason || \"Build failed\"\n                });\n            }\n            let files = normalizeFiles(result.files);\n            // HARD GUARANTEE: never write zero files\n            if (files.length === 0) {\n                files = fallbackScaffold(message);\n            }\n            // Write files into sandbox (await is critical if writeFiles is async)\n            await (0,_lib_sandbox_fs__WEBPACK_IMPORTED_MODULE_3__.writeFiles)(projectId, files);\n            // ✅ Canonical file list from disk (not just this iteration)\n            const diskFilePaths = (0,_lib_sandbox_fs__WEBPACK_IMPORTED_MODULE_3__.listFiles)(projectId);\n            // Update meta:\n            const meta = (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.readMeta)(projectId) || {};\n            const bi = meta.buildInfo;\n            // Keep a rolling list of core features (iteration, not regeneration)\n            const nextFeatures = (()=>{\n                if (!bi) return null;\n                const existing = Array.isArray(bi.coreFeatures) ? bi.coreFeatures : [];\n                const suggestion = safeTrim(message).split(\"\\n\")[0].slice(0, 80);\n                if (!suggestion) return existing.slice(0, 8);\n                const merged = [\n                    suggestion,\n                    ...existing\n                ].filter((v, i, arr)=>arr.findIndex((x)=>x.toLowerCase() === v.toLowerCase()) === i);\n                return merged.slice(0, 8);\n            })();\n            (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.writeMeta)(projectId, {\n                ...meta,\n                built: true,\n                entry: \"index.html\",\n                files: diskFilePaths,\n                version: (typeof meta.version === \"number\" ? meta.version : 0) + 1,\n                lastBuildAt: new Date().toISOString(),\n                updatedAt: new Date().toISOString(),\n                ...bi && nextFeatures ? {\n                    buildInfo: {\n                        ...bi,\n                        coreFeatures: nextFeatures\n                    }\n                } : {}\n            });\n            const assistantMessage = sanitizeAssistantMessage(result.assistantMessage, `Built project and wrote ${files.length} file(s) to the project folder.`);\n            (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.appendChat)(projectId, {\n                role: \"assistant\",\n                content: assistantMessage\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                ok: true,\n                type: \"build\",\n                reply: assistantMessage,\n                filesWritten: diskFilePaths\n            });\n        }\n        // CHAT MODE\n        const metaNow = await updateRollingMemory(projectId);\n        const memory = typeof metaNow.memory === \"string\" ? metaNow.memory : \"\";\n        const metaForChat = (0,_lib_sandbox_meta__WEBPACK_IMPORTED_MODULE_5__.readMeta)(projectId) || {};\n        const buildInfoForChat = metaForChat.buildInfo || null;\n        // Project awareness: provide the current file tree (paths only) as authoritative grounding.\n        const projectFilePaths = (0,_lib_sandbox_fs__WEBPACK_IMPORTED_MODULE_3__.listFiles)(projectId).slice(0, 400);\n        const history = (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.readChat)(projectId, 80);\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-5.2\",\n            temperature: 0.7,\n            messages: [\n                {\n                    role: \"system\",\n                    content: \"You are Devassist, the AI builder running inside THIS project. Answer questions using the project's Build Info, memory, and file tree. \" + \"Do NOT say you are ChatGPT or a general-purpose assistant. Be concise and practical. \" + \"Never change platform/language/framework/app name unless the user explicitly asks.\"\n                },\n                {\n                    role: \"system\",\n                    content: `Project files (authoritative paths):\\n${projectFilePaths.length ? projectFilePaths.map((p)=>`- ${p}`).join(\"\\n\") : \"(no files yet)\"}`\n                },\n                {\n                    role: \"system\",\n                    content: `Build Info (source of truth; MUST obey):\\n${buildInfoForChat ? JSON.stringify(buildInfoForChat, null, 2) : \"(not set yet)\"}`\n                },\n                ...memory ? [\n                    {\n                        role: \"system\",\n                        content: `Project memory (authoritative):\\n${memory}`\n                    }\n                ] : [],\n                ...history.map((m)=>({\n                        role: m.role,\n                        content: m.content\n                    }))\n            ]\n        });\n        const reply = completion.choices[0].message.content || \"\";\n        (0,_lib_sandbox_chatStore__WEBPACK_IMPORTED_MODULE_2__.appendChat)(projectId, {\n            role: \"assistant\",\n            content: reply\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            type: \"text\",\n            reply\n        });\n    } catch (err) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: false,\n            error: err?.message || \"Chat error\"\n        }, {\n            status: 200\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3Byb2plY3QvW2lkXS9jaGF0L3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEscUNBQXFDO0FBQ007QUFDZjtBQUNBO0FBRW1DO0FBQ2E7QUFDckI7QUFDRTtBQUVsRCxNQUFNVyxVQUFVLFNBQVM7QUFFaEMsTUFBTUMsU0FBUyxJQUFJWCw4Q0FBTUEsQ0FBQztJQUN4QlksUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO0FBQ3BDO0FBSUEsU0FBU0M7SUFDUCxPQUFPZix3REFBaUI7QUFDMUI7QUFFQSxTQUFTaUIsU0FBU0MsQ0FBTTtJQUN0QixPQUFPLE9BQU9BLE1BQU0sV0FBV0EsRUFBRUMsSUFBSSxLQUFLO0FBQzVDO0FBRUEsU0FBU0MseUJBQXlCQyxHQUFRLEVBQUVDLFFBQWdCO0lBQzFELE1BQU1DLElBQUksT0FBT0YsUUFBUSxXQUFXQSxJQUFJRixJQUFJLEtBQUs7SUFDakQsSUFBSSxDQUFDSSxHQUFHLE9BQU9EO0lBRWYsTUFBTUUsV0FBV0QsRUFBRUUsUUFBUSxDQUFDO0lBQzVCLE1BQU1DLGdCQUFnQixtQkFBbUJDLElBQUksQ0FBQ0o7SUFDOUMsTUFBTUssYUFBYSxDQUFDTCxFQUFFTSxLQUFLLENBQUMsMkVBQTJFLEVBQUUsRUFDdEdDLE1BQU07SUFFVCxJQUFJTixZQUFZRSxpQkFBaUJFLGNBQWMsS0FBS0wsRUFBRU8sTUFBTSxHQUFHLEtBQUssT0FBT1I7SUFFM0UsTUFBTVMsZ0JBQWdCUixFQUFFUyxPQUFPLENBQUMsbUJBQW1CLElBQUliLElBQUk7SUFDM0QsT0FBT1ksaUJBQWlCVDtBQUMxQjtBQUVBOzs7O0NBSUMsR0FDRCxTQUFTVyxjQUNQQyxJQUFZO0lBRVosTUFBTVgsSUFBSSxDQUFDVyxRQUFRLEVBQUMsRUFBR0MsV0FBVztJQUVsQyxNQUFNQyxTQUNKLGtFQUFrRVQsSUFBSSxDQUFDSjtJQUN6RSxNQUFNYyxTQUFTLDhCQUE4QlYsSUFBSSxDQUFDSjtJQUNsRCxNQUFNZSxh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YXBwL2FwaS9wcm9qZWN0L1tpZF0vY2hhdC9yb3V0ZS50cz8zNGM2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGFwcC9hcGkvcHJvamVjdC9baWRdL2NoYXQvcm91dGUudHNcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5pbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcblxuaW1wb3J0IHsgYXBwZW5kQ2hhdCwgcmVhZENoYXQgfSBmcm9tIFwiQC9saWIvc2FuZGJveC9jaGF0U3RvcmVcIjtcbmltcG9ydCB7IHdyaXRlRmlsZXMsIGxpc3RGaWxlcywgcmVhZEZpbGVzU25hcHNob3QgfSBmcm9tIFwiQC9saWIvc2FuZGJveC9mc1wiO1xuaW1wb3J0IHsgZ2VuZXJhdGVGaWxlcyB9IGZyb20gXCJAL2xpYi9haS9nZW5lcmF0ZUZpbGVzXCI7XG5pbXBvcnQgeyByZWFkTWV0YSwgd3JpdGVNZXRhIH0gZnJvbSBcIkAvbGliL3NhbmRib3gvbWV0YVwiO1xuXG5leHBvcnQgY29uc3QgcnVudGltZSA9IFwibm9kZWpzXCI7XG5cbmNvbnN0IG9wZW5haSA9IG5ldyBPcGVuQUkoe1xuICBhcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZISxcbn0pO1xuXG50eXBlIFNhbmRib3hGaWxlID0geyBwYXRoOiBzdHJpbmc7IGNvbnRlbnQ6IHN0cmluZyB9O1xuXG5mdW5jdGlvbiB1aWQoKSB7XG4gIHJldHVybiBjcnlwdG8ucmFuZG9tVVVJRCgpO1xufVxuXG5mdW5jdGlvbiBzYWZlVHJpbShzOiBhbnkpIHtcbiAgcmV0dXJuIHR5cGVvZiBzID09PSBcInN0cmluZ1wiID8gcy50cmltKCkgOiBcIlwiO1xufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZUFzc2lzdGFudE1lc3NhZ2UobXNnOiBhbnksIGZhbGxiYWNrOiBzdHJpbmcpIHtcbiAgY29uc3QgdCA9IHR5cGVvZiBtc2cgPT09IFwic3RyaW5nXCIgPyBtc2cudHJpbSgpIDogXCJcIjtcbiAgaWYgKCF0KSByZXR1cm4gZmFsbGJhY2s7XG5cbiAgY29uc3QgaGFzRmVuY2UgPSB0LmluY2x1ZGVzKFwiYGBgXCIpO1xuICBjb25zdCBoYXNGaWxlSGVhZGVyID0gL14tLS1cXHMrLitcXHMrLS0tL20udGVzdCh0KTtcbiAgY29uc3QgY29kZXlMaW5lcyA9ICh0Lm1hdGNoKC9eXFxzKihpbXBvcnRcXHMrfGV4cG9ydFxccyt8Y29uc3RcXHMrfGZ1bmN0aW9uXFxzK3xjbGFzc1xccyt8PFxcdyt8e1xccyokKS9nbSkgfHwgW10pXG4gICAgLmxlbmd0aDtcblxuICBpZiAoaGFzRmVuY2UgfHwgaGFzRmlsZUhlYWRlciB8fCBjb2RleUxpbmVzID49IDMgfHwgdC5sZW5ndGggPiA5MDApIHJldHVybiBmYWxsYmFjaztcblxuICBjb25zdCB3aXRob3V0RmVuY2VzID0gdC5yZXBsYWNlKC9gYGBbXFxzXFxTXSo/YGBgL2csIFwiXCIpLnRyaW0oKTtcbiAgcmV0dXJuIHdpdGhvdXRGZW5jZXMgfHwgZmFsbGJhY2s7XG59XG5cbi8qKlxuICogUExBVEZPUk0gSU5GRVJFTkNFIChubyB0ZWNobmljYWwgcXVlc3Rpb25zIHVwZnJvbnQpXG4gKiAtIGluZmVyIGZyb20gZmlyc3QgcHJvbXB0XG4gKiAtIGlmIHVuY2xlYXIsIGFzayBPTkUgc2ltcGxlIHF1ZXN0aW9uICh0aGVuIGRlZmF1bHQgdG8gd2ViIGlmIHN0aWxsIHVuY2xlYXIpXG4gKi9cbmZ1bmN0aW9uIGluZmVyUGxhdGZvcm0oXG4gIHRleHQ6IHN0cmluZ1xuKTogXCJ3ZWJcIiB8IFwiaW9zXCIgfCBcImFuZHJvaWRcIiB8IFwiaW9zX2FuZHJvaWRcIiB8IG51bGwge1xuICBjb25zdCB0ID0gKHRleHQgfHwgXCJcIikudG9Mb3dlckNhc2UoKTtcblxuICBjb25zdCBoYXNXZWIgPVxuICAgIC9cXGIod2VifHdlYnNpdGV8c2Fhc3xkYXNoYm9hcmR8bGFuZGluZyBwYWdlfG5leHRcXC4/anN8YnJvd3NlcilcXGIvLnRlc3QodCk7XG4gIGNvbnN0IGhhc0lPUyA9IC9cXGIoaW9zfGlwaG9uZXxpcGFkfGFwcGxlKVxcYi8udGVzdCh0KTtcbiAgY29uc3QgaGFzQW5kcm9pZCA9IC9cXGIoYW5kcm9pZClcXGIvLnRlc3QodCk7XG5cbiAgaWYgKGhhc0lPUyAmJiBoYXNBbmRyb2lkKSByZXR1cm4gXCJpb3NfYW5kcm9pZFwiO1xuICBpZiAoaGFzSU9TKSByZXR1cm4gXCJpb3NcIjtcbiAgaWYgKGhhc0FuZHJvaWQpIHJldHVybiBcImFuZHJvaWRcIjtcbiAgaWYgKGhhc1dlYikgcmV0dXJuIFwid2ViXCI7XG5cbiAgLy8gSWYgdGhleSBzYXkgXCJhcHBcIiBidXQgZG9u4oCZdCBzcGVjaWZ5IHBsYXRmb3JtLCBpdOKAmXMgdW5jbGVhciAtPiBhc2sgb25jZS5cbiAgaWYgKC9cXGJhcHBcXGIvLnRlc3QodCkpIHJldHVybiBudWxsO1xuXG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBwYXJzZVBsYXRmb3JtQW5zd2VyKFxuICB0ZXh0OiBzdHJpbmdcbik6IFwid2ViXCIgfCBcImlvc1wiIHwgXCJhbmRyb2lkXCIgfCBcImlvc19hbmRyb2lkXCIgfCBudWxsIHtcbiAgY29uc3QgdCA9ICh0ZXh0IHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmICgvXFxiKGJvdGh8aW9zIGFuZCBhbmRyb2lkfGlwaG9uZSBhbmQgYW5kcm9pZHxhbmRyb2lkIGFuZCBpcGhvbmUpXFxiLy50ZXN0KHQpKVxuICAgIHJldHVybiBcImlvc19hbmRyb2lkXCI7XG4gIGlmICgvXFxiKHdlYnx3ZWJzaXRlfGJyb3dzZXJ8c2FhcylcXGIvLnRlc3QodCkpIHJldHVybiBcIndlYlwiO1xuICBpZiAoL1xcYihpb3N8aXBob25lfGlwYWR8YXBwbGUpXFxiLy50ZXN0KHQpKSByZXR1cm4gXCJpb3NcIjtcbiAgaWYgKC9cXGIoYW5kcm9pZClcXGIvLnRlc3QodCkpIHJldHVybiBcImFuZHJvaWRcIjtcbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogRGVmYXVsdCBwbGF0Zm9ybSDihpIgbGFuZ3VhZ2Ug4oaSIGZyYW1ld29yayBydWxlcyAoTE9DS0VEKVxuICovXG5mdW5jdGlvbiBidWlsZEluZm9EZWZhdWx0cyhwbGF0Zm9ybTogXCJ3ZWJcIiB8IFwiaW9zXCIgfCBcImFuZHJvaWRcIiB8IFwiaW9zX2FuZHJvaWRcIikge1xuICBpZiAocGxhdGZvcm0gPT09IFwid2ViXCIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcGxhdGZvcm0sXG4gICAgICBmcmFtZXdvcms6IFwibmV4dGpzXCIgYXMgY29uc3QsXG4gICAgICBsYW5ndWFnZTogXCJqYXZhc2NyaXB0XCIgYXMgY29uc3QsXG4gICAgfTtcbiAgfVxuICBpZiAocGxhdGZvcm0gPT09IFwiaW9zX2FuZHJvaWRcIikge1xuICAgIHJldHVybiB7XG4gICAgICBwbGF0Zm9ybSxcbiAgICAgIGZyYW1ld29yazogXCJzaGFyZWRfbW9iaWxlXCIgYXMgY29uc3QsXG4gICAgICBsYW5ndWFnZTogXCJqYXZhc2NyaXB0XCIgYXMgY29uc3QsXG4gICAgfTtcbiAgfVxuICBpZiAocGxhdGZvcm0gPT09IFwiaW9zXCIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcGxhdGZvcm0sXG4gICAgICBmcmFtZXdvcms6IFwic3dpZnRcIiBhcyBjb25zdCxcbiAgICAgIGxhbmd1YWdlOiBcInN3aWZ0XCIgYXMgY29uc3QsXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHBsYXRmb3JtLFxuICAgIGZyYW1ld29yazogXCJrb3RsaW5cIiBhcyBjb25zdCxcbiAgICBsYW5ndWFnZTogXCJrb3RsaW5cIiBhcyBjb25zdCxcbiAgfTtcbn1cblxuZnVuY3Rpb24gaXNJbWFnZVJlcXVlc3QodGV4dDogc3RyaW5nKSB7XG4gIGNvbnN0IHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7XG4gIHJldHVybiAoXG4gICAgdC5pbmNsdWRlcyhcIm1vY2t1cFwiKSB8fFxuICAgIHQuaW5jbHVkZXMoXCJ3aXJlZnJhbWVcIikgfHxcbiAgICB0LmluY2x1ZGVzKFwidWkgZGVzaWduXCIpIHx8XG4gICAgdC5pbmNsdWRlcyhcInVpIG1vY2t1cFwiKSB8fFxuICAgIHQuaW5jbHVkZXMoXCJkZXNpZ24gaW1hZ2VcIikgfHxcbiAgICB0LmluY2x1ZGVzKFwic2NyZWVuIGRlc2lnblwiKSB8fFxuICAgIHQuaW5jbHVkZXMoXCJkYXNoYm9hcmQgdWlcIikgfHxcbiAgICB0LmluY2x1ZGVzKFwiY3JlYXRlIGEgdWlcIikgfHxcbiAgICB0LmluY2x1ZGVzKFwidWkgaW1hZ2VcIikgfHxcbiAgICB0LmluY2x1ZGVzKFwibW9jayB1cFwiKSAvLyBJTVBPUlRBTlQ6IGNhdGNoIFwibW9jayB1cFwiIHRvb1xuICApO1xufVxuXG5mdW5jdGlvbiBpc0J1aWxkUmVxdWVzdCh0ZXh0OiBzdHJpbmcpIHtcbiAgY29uc3QgdCA9IHRleHQudG9Mb3dlckNhc2UoKTtcblxuICAvLyBFeHBsaWNpdCBidWlsZCB2ZXJic1xuICBpZiAoXG4gICAgdC5pbmNsdWRlcyhcImJ1aWxkXCIpIHx8XG4gICAgdC5pbmNsdWRlcyhcImNyZWF0ZSBhbiBhcHBcIikgfHxcbiAgICB0LmluY2x1ZGVzKFwiY3JlYXRlIGEgcHJvamVjdFwiKSB8fFxuICAgIHQuaW5jbHVkZXMoXCJnZW5lcmF0ZSBjb2RlXCIpIHx8XG4gICAgdC5pbmNsdWRlcyhcIndyaXRlIGNvZGVcIikgfHxcbiAgICB0LmluY2x1ZGVzKFwic2V0IHVwXCIpIHx8XG4gICAgdC5pbmNsdWRlcyhcImltcGxlbWVudFwiKSB8fFxuICAgIHQuaW5jbHVkZXMoXCJ1cGRhdGUgdGhlIGFwcFwiKSB8fFxuICAgIHQuaW5jbHVkZXMoXCJtb2RpZnkgdGhlIGFwcFwiKSB8fFxuICAgIHQuaW5jbHVkZXMoXCJjaGFuZ2UgdGhlIGFwcFwiKVxuICApIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIFwiQnVpbGRlci1pc2hcIiBwaHJhc2luZyB0aGF0IHVzZXJzIGNvbW1vbmx5IHVzZS5cbiAgaWYgKHQuaW5jbHVkZXMoXCJjcmVhdGUgYVwiKSB8fCB0LmluY2x1ZGVzKFwiYWRkIGFcIikgfHwgdC5pbmNsdWRlcyhcIm1ha2UgdGhpc1wiKSB8fCB0LmluY2x1ZGVzKFwiYXBwIHRoYXRcIikpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIElmIHRoZSB1c2VyIGlzIGNsZWFybHkgZGVzY3JpYmluZyBhbiBhcHAgc3BlYyAocGxhdGZvcm0vZnJhbWV3b3JrICsgcmVxdWlyZW1lbnRzKSxcbiAgLy8gdHJlYXQgaXQgYXMgYSBidWlsZCByZXF1ZXN0IGV2ZW4gaWYgdGhleSBkaWRuJ3Qgc2F5IFwiYnVpbGRcIi5cbiAgLy8gVGhpcyBmaXhlcyBjYXNlcyBsaWtlOiBcIkl0IGlzIGFuIGFwcCBmb3IgYm90aCBhbmRyb2lkIGFuZCBpT1MuIHVzZSBvcGVud2VhdGhlcm1hcC4uLlwiXG4gIGNvbnN0IG1lbnRpb25zUGxhdGZvcm1PclN0YWNrID1cbiAgICAvXFxiKGl0IGlzfGl0J3MpXFxzKyhhbj9cXHMrKT9hcHBcXGIvLnRlc3QodCkgfHxcbiAgICAvXFxiKGlvc3xhbmRyb2lkfGlwaG9uZXxpcGFkfHJlYWN0XFxzKm5hdGl2ZXxleHBvfG5leHRcXC4/anN8d2ViIGFwcHxzYWFzKVxcYi8udGVzdCh0KTtcblxuICBjb25zdCByZXF1aXJlbWVudEhpdHMgPSAodC5tYXRjaCgvXFxiKHVzZXxzdXBwb3J0fGluY2x1ZGV8c2hvdWxkfG11c3R8bmVlZHx3aXRofGFkZClcXGIvZykgfHwgW10pLmxlbmd0aDtcbiAgY29uc3QgaGFzRmlsZU9yQ29kZVNpZ25hbHMgPSAvXFxiKHJlYWRtZXxwYWNrYWdlXFwuanNvbnxhcHBcXC5qc3xpbmRleFxcLmh0bWx8c3JjXFwvfFxcLmVudnxlbmRwb2ludHxhcGkga2V5KVxcYi8udGVzdCh0KTtcblxuICBpZiAoKG1lbnRpb25zUGxhdGZvcm1PclN0YWNrICYmIHJlcXVpcmVtZW50SGl0cyA+PSAyKSB8fCBoYXNGaWxlT3JDb2RlU2lnbmFscykgcmV0dXJuIHRydWU7XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vKipcbiAqIEtlZXAgYW55IGZpbGUgdGhhdCBoYXMgYSBwYXRoOyBhbGxvdyBlbXB0eSBjb250ZW50IHRvbyAoc3RpbGwgY3JlYXRlcyBhIGZpbGUpLlxuICogVGhpcyBwcmV2ZW50cyBcIm5vIGZpbGVzIHdyaXR0ZW5cIiB3aGVuIHRoZSBtb2RlbCByZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBmb3Igc29tZSBmaWxlcy5cbiAqL1xuZnVuY3Rpb24gbm9ybWFsaXplRmlsZXMoZmlsZXM6IGFueSk6IFNhbmRib3hGaWxlW10ge1xuICBpZiAoIUFycmF5LmlzQXJyYXkoZmlsZXMpKSByZXR1cm4gW107XG4gIGNvbnN0IG91dDogU2FuZGJveEZpbGVbXSA9IFtdO1xuXG4gIGZvciAoY29uc3QgZiBvZiBmaWxlcykge1xuICAgIGlmICghZikgY29udGludWU7XG4gICAgY29uc3QgcGF0aCA9IHR5cGVvZiBmLnBhdGggPT09IFwic3RyaW5nXCIgPyBmLnBhdGgudHJpbSgpIDogXCJcIjtcbiAgICBjb25zdCBjb250ZW50ID0gdHlwZW9mIGYuY29udGVudCA9PT0gXCJzdHJpbmdcIiA/IGYuY29udGVudCA6IFwiXCI7XG4gICAgaWYgKCFwYXRoKSBjb250aW51ZTtcblxuICAgIC8vIHByZXZlbnQgd2VpcmQgYWJzb2x1dGUgcGF0aHNcbiAgICBjb25zdCBzYWZlUGF0aCA9IHBhdGgucmVwbGFjZSgvXihcXC5cXC5cXC8pKy9nLCBcIlwiKS5yZXBsYWNlKC9eXFwvKy8sIFwiXCIpO1xuICAgIG91dC5wdXNoKHsgcGF0aDogc2FmZVBhdGgsIGNvbnRlbnQgfSk7XG4gIH1cblxuICAvLyBkZS1kdXBlIGJ5IHBhdGggKGxhc3Qgb25lIHdpbnMpXG4gIGNvbnN0IGJ5UGF0aCA9IG5ldyBNYXA8c3RyaW5nLCBTYW5kYm94RmlsZT4oKTtcbiAgZm9yIChjb25zdCBmIG9mIG91dCkgYnlQYXRoLnNldChmLnBhdGgsIGYpO1xuICByZXR1cm4gQXJyYXkuZnJvbShieVBhdGgudmFsdWVzKCkpO1xufVxuXG4vKipcbiAqIEhhcmQgZ3VhcmFudGVlOiBpZiB0aGUgbW9kZWwgcmV0dXJucyBubyBmaWxlcywgd2Ugc3RpbGwgY3JlYXRlIGEgcmVhbCBzY2FmZm9sZC5cbiAqIFRoaXMgcHJldmVudHMgdGhlIOKAnHRveS9kdW1teeKAnSBmZWVsIGFuZCBndWFyYW50ZWVzIHRoZSBwcm9qZWN0IGZvbGRlciBpcyBuZXZlciBlbXB0eS5cbiAqL1xuZnVuY3Rpb24gZmFsbGJhY2tTY2FmZm9sZCh1c2VyUHJvbXB0OiBzdHJpbmcpOiBTYW5kYm94RmlsZVtdIHtcbiAgcmV0dXJuIFtcbiAgICB7XG4gICAgICBwYXRoOiBcIlJFQURNRS5tZFwiLFxuICAgICAgY29udGVudDogYCMgRGV2YXNzaXN0IFByb2plY3RcblxuIyMgR29hbFxuJHt1c2VyUHJvbXB0fVxuXG4jIyBXaGF0IHlvdSBnb3Rcbi0gQSByZWFsIGZpbGUgc2NhZmZvbGQgd3JpdHRlbiBpbnRvIHRoZSBwcm9qZWN0IGZvbGRlciAoZXZlbiBpZiBzb21lIHJ1bnRpbWUgZmVhdHVyZXMgYXJlIGxpbWl0ZWQgaW4gc2FuZGJveClcbi0gQSB3b3JraW5nIGxvY2FsIHByb3h5IGV4YW1wbGUgZm9yIHJlYWwtdGltZSBQbGFjZXMgZGF0YSAoQ09SUy1zYWZlICsgaGlkZXMgQVBJIGtleSlcbi0gQSBzaW1wbGUgZnJvbnRlbmQgdGhhdCBjYWxscyB0aGUgcHJveHlcblxuIyMgUmVhbC10aW1lIHJlc3RhdXJhbnRzIChpbXBvcnRhbnQpXG5Ccm93c2VyIGNhbGxzIHRvIEdvb2dsZSBQbGFjZXMgV2ViIFNlcnZpY2UgZW5kcG9pbnRzIG9mdGVuIGZhaWwgZHVlIHRvIENPUlMgYW5kIGV4cG9zZSB5b3VyIEFQSSBrZXkuXG5Vc2UgdGhlIGluY2x1ZGVkIHByb3h5IChcXGBzZXJ2ZXIvcHJveHkuanNcXGApIGFuZCBrZWVwIHRoZSBrZXkgaW4gXFxgLmVudlxcYC5cblxuIyMgUnVuXG4xKSBDb3B5IGVudjpcbiAgIC0gY3AgLmVudi5leGFtcGxlIC5lbnZcbiAgIC0gc2V0IEdPT0dMRV9QTEFDRVNfQVBJX0tFWVxuXG4yKSBTdGFydCBwcm94eTpcbiAgIC0gbm9kZSBzZXJ2ZXIvcHJveHkuanNcblxuMykgU2VydmUgZnJvbnRlbmQgbG9jYWxseTpcbiAgIC0gcHl0aG9uIC1tIGh0dHAuc2VydmVyIDUxNzNcbiAgIC0gb3BlbiBodHRwOi8vbG9jYWxob3N0OjUxNzNcblxuYCxcbiAgICB9LFxuICAgIHtcbiAgICAgIHBhdGg6IFwiLmVudi5leGFtcGxlXCIsXG4gICAgICBjb250ZW50OiBgIyBETyBOT1QgQ09NTUlUIFJFQUwgS0VZU1xuXG5HT09HTEVfUExBQ0VTX0FQSV9LRVk9WU9VUl9LRVlfSEVSRVxuUE9SVD04Nzg3XG5gLFxuICAgIH0sXG4gICAge1xuICAgICAgcGF0aDogXCJzZXJ2ZXIvcHJveHkuanNcIixcbiAgICAgIGNvbnRlbnQ6IGAvKipcbiAqIE1pbmltYWwgTm9kZSBwcm94eSBmb3IgR29vZ2xlIFBsYWNlcyBXZWIgU2VydmljZSAoYXZvaWRzIENPUlMgKyBoaWRlcyBBUEkga2V5KS5cbiAqIFJ1bjogbm9kZSBzZXJ2ZXIvcHJveHkuanNcbiAqIEZyb250ZW5kIGNhbGxzOiBodHRwOi8vbG9jYWxob3N0Ojg3ODcvYXBpL3BsYWNlcy9uZWFyYnk/Li4uIGFuZCAvYXBpL3BsYWNlcy9kZXRhaWxzP3BsYWNlSWQ9Li4uXG4gKlxuICogTk9URTpcbiAqIC0gUmVxdWlyZXMgTm9kZSAxOCsgKGdsb2JhbCBmZXRjaClcbiAqIC0gVGhpcyBpcyBpbnRlbnRpb25hbGx5IG1pbmltYWw7IGFkZCByYXRlIGxpbWl0aW5nICsgY2FjaGluZyBmb3IgcHJvZHVjdGlvbi5cbiAqL1xuaW1wb3J0IGh0dHAgZnJvbSBcImh0dHBcIjtcbmltcG9ydCB7IFVSTCB9IGZyb20gXCJ1cmxcIjtcblxuY29uc3QgUE9SVCA9IE51bWJlcihwcm9jZXNzLmVudi5QT1JUIHx8IDg3ODcpO1xuY29uc3QgQVBJX0tFWSA9IHByb2Nlc3MuZW52LkdPT0dMRV9QTEFDRVNfQVBJX0tFWTtcblxuaWYgKCFBUElfS0VZKSB7XG4gIGNvbnNvbGUuZXJyb3IoXCJNaXNzaW5nIEdPT0dMRV9QTEFDRVNfQVBJX0tFWS4gQ3JlYXRlIGEgLmVudiBmaWxlIGZyb20gLmVudi5leGFtcGxlXCIpO1xuICBwcm9jZXNzLmV4aXQoMSk7XG59XG5cbmZ1bmN0aW9uIHNlbmRKc29uKHJlcywgc3RhdHVzLCBvYmopIHtcbiAgcmVzLndyaXRlSGVhZChzdGF0dXMsIHtcbiAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIixcbiAgICBcImFjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpblwiOiBcIipcIixcbiAgICBcImFjY2Vzcy1jb250cm9sLWFsbG93LW1ldGhvZHNcIjogXCJHRVQsT1BUSU9OU1wiLFxuICAgIFwiYWNjZXNzLWNvbnRyb2wtYWxsb3ctaGVhZGVyc1wiOiBcImNvbnRlbnQtdHlwZVwiLFxuICB9KTtcbiAgcmVzLmVuZChKU09OLnN0cmluZ2lmeShvYmopKTtcbn1cblxuZnVuY3Rpb24gc2VuZChyZXMsIHN0YXR1cywgdGV4dCkge1xuICByZXMud3JpdGVIZWFkKHN0YXR1cywge1xuICAgIFwiY29udGVudC10eXBlXCI6IFwidGV4dC9wbGFpbjsgY2hhcnNldD11dGYtOFwiLFxuICAgIFwiYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luXCI6IFwiKlwiLFxuICAgIFwiYWNjZXNzLWNvbnRyb2wtYWxsb3ctbWV0aG9kc1wiOiBcIkdFVCxPUFRJT05TXCIsXG4gICAgXCJhY2Nlc3MtY29udHJvbC1hbGxvdy1oZWFkZXJzXCI6IFwiY29udGVudC10eXBlXCIsXG4gIH0pO1xuICByZXMuZW5kKHRleHQpO1xufVxuXG5jb25zdCBzZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcihhc3luYyAocmVxLCByZXMpID0+IHtcbiAgaWYgKHJlcS5tZXRob2QgPT09IFwiT1BUSU9OU1wiKSByZXR1cm4gc2VuZChyZXMsIDIwNCwgXCJcIik7XG4gIGlmIChyZXEubWV0aG9kICE9PSBcIkdFVFwiKSByZXR1cm4gc2VuZChyZXMsIDQwNSwgXCJtZXRob2Qgbm90IGFsbG93ZWRcIik7XG5cbiAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsLCBcImh0dHA6Ly9sb2NhbGhvc3RcIik7XG4gIGlmICh1cmwucGF0aG5hbWUgPT09IFwiL2FwaS9wbGFjZXMvbmVhcmJ5XCIpIHtcbiAgICBjb25zdCBsYXQgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcImxhdFwiKTtcbiAgICBjb25zdCBsbmcgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcImxuZ1wiKTtcbiAgICBjb25zdCByYWRpdXMgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcInJhZGl1c1wiKSB8fCBcIjE1MDBcIjtcbiAgICBjb25zdCBrZXl3b3JkID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJrZXl3b3JkXCIpIHx8IFwicmVzdGF1cmFudFwiO1xuXG4gICAgaWYgKCFsYXQgfHwgIWxuZykgcmV0dXJuIHNlbmRKc29uKHJlcywgNDAwLCB7IGVycm9yOiBcImxhdCxsbmcgcmVxdWlyZWRcIiB9KTtcblxuICAgIGNvbnN0IHVwc3RyZWFtID0gbmV3IFVSTChcImh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9wbGFjZS9uZWFyYnlzZWFyY2gvanNvblwiKTtcbiAgICAvLyDinIUgRklYOiBlc2NhcGUgdGVtcGxhdGUgdmFycyBpbnNpZGUgVEhJUyBUeXBlU2NyaXB0IHRlbXBsYXRlIHN0cmluZ1xuICAgIHVwc3RyZWFtLnNlYXJjaFBhcmFtcy5zZXQoXCJsb2NhdGlvblwiLCBsYXQgKyBcIixcIiArIGxuZyk7XG4gICAgdXBzdHJlYW0uc2VhcmNoUGFyYW1zLnNldChcInJhZGl1c1wiLCByYWRpdXMpO1xuICAgIHVwc3RyZWFtLnNlYXJjaFBhcmFtcy5zZXQoXCJrZXl3b3JkXCIsIGtleXdvcmQpO1xuICAgIHVwc3RyZWFtLnNlYXJjaFBhcmFtcy5zZXQoXCJrZXlcIiwgQVBJX0tFWSk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgciA9IGF3YWl0IGZldGNoKHVwc3RyZWFtLnRvU3RyaW5nKCkpO1xuICAgICAgY29uc3QgaiA9IGF3YWl0IHIuanNvbigpO1xuICAgICAgcmV0dXJuIHNlbmRKc29uKHJlcywgMjAwLCBqKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gc2VuZEpzb24ocmVzLCA1MDAsIHsgZXJyb3I6IFwidXBzdHJlYW0gZmV0Y2ggZmFpbGVkXCIgfSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHVybC5wYXRobmFtZSA9PT0gXCIvYXBpL3BsYWNlcy9kZXRhaWxzXCIpIHtcbiAgICBjb25zdCBwbGFjZUlkID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJwbGFjZUlkXCIpO1xuICAgIGlmICghcGxhY2VJZCkgcmV0dXJuIHNlbmRKc29uKHJlcywgNDAwLCB7IGVycm9yOiBcInBsYWNlSWQgcmVxdWlyZWRcIiB9KTtcblxuICAgIGNvbnN0IHVwc3RyZWFtID0gbmV3IFVSTChcImh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9wbGFjZS9kZXRhaWxzL2pzb25cIik7XG4gICAgdXBzdHJlYW0uc2VhcmNoUGFyYW1zLnNldChcInBsYWNlX2lkXCIsIHBsYWNlSWQpO1xuICAgIHVwc3RyZWFtLnNlYXJjaFBhcmFtcy5zZXQoXCJmaWVsZHNcIiwgXCJuYW1lLGZvcm1hdHRlZF9hZGRyZXNzLHJhdGluZyxvcGVuaW5nX2hvdXJzLHdlYnNpdGUsZm9ybWF0dGVkX3Bob25lX251bWJlcixwaG90b3NcIik7XG4gICAgdXBzdHJlYW0uc2VhcmNoUGFyYW1zLnNldChcImtleVwiLCBBUElfS0VZKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByID0gYXdhaXQgZmV0Y2godXBzdHJlYW0udG9TdHJpbmcoKSk7XG4gICAgICBjb25zdCBqID0gYXdhaXQgci5qc29uKCk7XG4gICAgICByZXR1cm4gc2VuZEpzb24ocmVzLCAyMDAsIGopO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBzZW5kSnNvbihyZXMsIDUwMCwgeyBlcnJvcjogXCJ1cHN0cmVhbSBmZXRjaCBmYWlsZWRcIiB9KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc2VuZChyZXMsIDQwNCwgXCJub3QgZm91bmRcIik7XG59KTtcblxuc2VydmVyLmxpc3RlbihQT1JULCAoKSA9PiB7XG4gIGNvbnNvbGUubG9nKFwiUHJveHkgbGlzdGVuaW5nIG9uXCIsIFBPUlQpO1xufSk7XG5gLFxuICAgIH0sXG4gIF07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN1bW1hcml6ZUZvck1lbW9yeShoaXN0b3J5OiBBcnJheTx7IHJvbGU6IHN0cmluZzsgY29udGVudDogc3RyaW5nIH0+KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdHJpbW1lZCA9IGhpc3Rvcnkuc2xpY2UoLTQwKTtcbiAgICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBcImdwdC01LjJcIixcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjIsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgXCJTdW1tYXJpemUgdGhlIHByb2plY3QgY29udmVyc2F0aW9uIGludG8gYSBzaG9ydCwgZmFjdHVhbCBtZW1vcnkgZm9yIGZ1dHVyZSBpdGVyYXRpb25zLiBcIiArXG4gICAgICAgICAgICBcIkNhcHR1cmUgZ29hbHMsIGNob3NlbiBzdGFjay9wbGF0Zm9ybSwga2V5IGRlY2lzaW9ucywgYW5kIHdoYXQgaGFzIGJlZW4gYnVpbHQgc28gZmFyLiBcIiArXG4gICAgICAgICAgICBcIk5vIGZsdWZmLiBSZXR1cm4gcGxhaW4gdGV4dCBvbmx5LlwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogdHJpbW1lZC5tYXAoKG0pID0+IGAke20ucm9sZS50b1VwcGVyQ2FzZSgpfTogJHttLmNvbnRlbnR9YCkuam9pbihcIlxcblwiKSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbXBsZXRpb24uY2hvaWNlcz8uWzBdPy5tZXNzYWdlPy5jb250ZW50Py50cmltKCkgfHwgXCJcIjtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlUm9sbGluZ01lbW9yeShwcm9qZWN0SWQ6IHN0cmluZykge1xuICBjb25zdCBtZXRhID0gcmVhZE1ldGEocHJvamVjdElkKSB8fCB7IGlkOiBwcm9qZWN0SWQgfTtcbiAgY29uc3QgaGlzdG9yeSA9IHJlYWRDaGF0KHByb2plY3RJZCwgMTIwKTtcbiAgY29uc3QgbWVtb3J5ID0gYXdhaXQgc3VtbWFyaXplRm9yTWVtb3J5KGhpc3RvcnkpO1xuXG4gIHRyeSB7XG4gICAgaWYgKG1lbW9yeSkge1xuICAgICAgY29uc3QgbmV4dCA9IHsgLi4ubWV0YSwgbWVtb3J5LCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9O1xuICAgICAgd3JpdGVNZXRhKHByb2plY3RJZCwgbmV4dCk7XG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9XG4gIH0gY2F0Y2gge1xuICAgIC8vIGRvbuKAmXQgYnJlYWsgYXBwIGlmIHN1bW1hcml6YXRpb24gZmFpbHNcbiAgfVxuXG4gIHJldHVybiBtZXRhO1xufVxuXG5mdW5jdGlvbiBzYXZlR2VuZXJhdGVkSW1hZ2VUb01ldGEoXG4gIHByb2plY3RJZDogc3RyaW5nLFxuICBpbWFnZTogeyB1cmw/OiBzdHJpbmc7IGRhdGFVcmw/OiBzdHJpbmc7IHByb21wdD86IHN0cmluZyB9XG4pIHtcbiAgY29uc3QgbWV0YSA9IHJlYWRNZXRhKHByb2plY3RJZCkgfHwgeyBpZDogcHJvamVjdElkIH07XG4gIGNvbnN0IGltYWdlcyA9IEFycmF5LmlzQXJyYXkoKG1ldGEgYXMgYW55KS5pbWFnZXMpID8gKG1ldGEgYXMgYW55KS5pbWFnZXMgOiBbXTtcblxuICBjb25zdCBuZXh0SW1hZ2UgPSB7XG4gICAgaWQ6IHVpZCgpLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIHByb21wdDogaW1hZ2UucHJvbXB0IHx8IFwiXCIsXG4gICAgLi4uKGltYWdlLnVybCA/IHsgdXJsOiBpbWFnZS51cmwgfSA6IHt9KSxcbiAgICAuLi4oaW1hZ2UuZGF0YVVybCA/IHsgZGF0YVVybDogaW1hZ2UuZGF0YVVybCB9IDoge30pLFxuICB9O1xuXG4gIGNvbnN0IG5leHQgPSB7XG4gICAgLi4ubWV0YSxcbiAgICBpbWFnZXM6IFtuZXh0SW1hZ2UsIC4uLmltYWdlc10uc2xpY2UoMCwgMjApLFxuICAgIGxhc3RJbWFnZTogbmV4dEltYWdlLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICB9O1xuXG4gIHdyaXRlTWV0YShwcm9qZWN0SWQsIG5leHQgYXMgYW55KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChcbiAgX3JlcTogUmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZyB9IH1cbikge1xuICB0cnkge1xuICAgIGNvbnN0IHByb2plY3RJZCA9IHBhcmFtcy5pZDtcblxuICAgIC8vIFJldHVybiB0aGUgbW9zdCByZWNlbnQgdHVybnMgZm9yIGh5ZHJhdGlvbiBvbiByZWxvYWQuXG4gICAgLy8gY2hhdFN0b3JlIGl0ZW1zIGFyZSBleHBlY3RlZCB0byBiZTogeyByb2xlLCBjb250ZW50LCBpbWFnZVVybD8sIGltYWdlRGF0YVVybD8gfVxuICAgIGNvbnN0IHR1cm5zID0gcmVhZENoYXQocHJvamVjdElkLCAyMDApLm1hcCgodDogYW55KSA9PiAoe1xuICAgICAgcm9sZTogdC5yb2xlLFxuICAgICAgY29udGVudDogdC5jb250ZW50LFxuICAgICAgLi4uKHQuaW1hZ2VVcmwgPyB7IGltYWdlVXJsOiB0LmltYWdlVXJsIH0gOiB7fSksXG4gICAgICAuLi4odC5pbWFnZURhdGFVcmwgPyB7IGltYWdlRGF0YVVybDogdC5pbWFnZURhdGFVcmwgfSA6IHt9KSxcbiAgICB9KSk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBvazogdHJ1ZSwgdHVybnMgfSk7XG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBvazogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnI/Lm1lc3NhZ2UgPyBTdHJpbmcoZXJyLm1lc3NhZ2UpIDogXCJGYWlsZWQgdG8gbG9hZCBjaGF0XCIsXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChcbiAgcmVxOiBSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogeyBpZDogc3RyaW5nIH0gfVxuKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgY29uc3QgbWVzc2FnZSA9XG4gICAgICB0eXBlb2YgYm9keS5tZXNzYWdlID09PSBcInN0cmluZ1wiID8gYm9keS5tZXNzYWdlIDogYm9keS5tZXNzYWdlPy50ZXh0O1xuXG4gICAgaWYgKCFtZXNzYWdlIHx8IHR5cGVvZiBtZXNzYWdlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBvazogZmFsc2UsXG4gICAgICAgIGVycm9yOiBcIkludmFsaWQgbWVzc2FnZSBwYXlsb2FkXCIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBwcm9qZWN0SWQgPSBwYXJhbXMuaWQ7XG5cbiAgICAvLyBQZXJzaXN0IHVzZXIgbWVzc2FnZSAodGhpcyBtYXRjaGVzIHlvdXIgd29ya2luZyBjaGF0U3RvcmUgc2hhcGUpXG4gICAgYXBwZW5kQ2hhdChwcm9qZWN0SWQsIHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IG1lc3NhZ2UgfSk7XG5cbiAgICAvLyAtLS0tIFBMQVRGT1JNIElORkVSRU5DRSArIEJVSUxEIElORk8gKG9uZSBxdWVzdGlvbiBtYXgpIC0tLS1cbiAgICBjb25zdCBtZXRhQXRTdGFydCA9IHJlYWRNZXRhKHByb2plY3RJZCkgfHwgeyBpZDogcHJvamVjdElkIH07XG4gICAgY29uc3QgcGVuZGluZ1Byb21wdCA9IHNhZmVUcmltKChtZXRhQXRTdGFydCBhcyBhbnkpLnBlbmRpbmdQbGF0Zm9ybVByb21wdCk7XG5cbiAgICBpZiAoIShtZXRhQXRTdGFydCBhcyBhbnkpLmJ1aWxkSW5mbykge1xuICAgICAgaWYgKHBlbmRpbmdQcm9tcHQpIHtcbiAgICAgICAgLy8gVGhleSBhcmUgYW5zd2VyaW5nIHRoZSBvbmUgY2xhcmlmaWNhdGlvbiBxdWVzdGlvblxuICAgICAgICBjb25zdCBwID0gcGFyc2VQbGF0Zm9ybUFuc3dlcihtZXNzYWdlKTtcbiAgICAgICAgY29uc3QgcmVzb2x2ZWQgPSBwID8/IFwid2ViXCI7IC8vIGFzayBvbmNlOyBkZWZhdWx0IHRvIHdlYiBpZiBzdGlsbCB1bmNsZWFyXG4gICAgICAgIGNvbnN0IGQgPSBidWlsZEluZm9EZWZhdWx0cyhyZXNvbHZlZCk7XG5cbiAgICAgICAgY29uc3QgYXBwTmFtZSA9XG4gICAgICAgICAgc2FmZVRyaW0oKG1ldGFBdFN0YXJ0IGFzIGFueSkudGl0bGUpIHx8IGBQcm9qZWN0ICR7cHJvamVjdElkfWA7XG4gICAgICAgIGNvbnN0IG9uZUxpbmVyID1cbiAgICAgICAgICBzYWZlVHJpbShwZW5kaW5nUHJvbXB0KS5zbGljZSgwLCAxNDApIHx8IFwiQXBwIGJ1aWxkIGluIHByb2dyZXNzLlwiO1xuXG4gICAgICAgIHdyaXRlTWV0YShwcm9qZWN0SWQsIHtcbiAgICAgICAgICAuLi5tZXRhQXRTdGFydCxcbiAgICAgICAgICBwZW5kaW5nUGxhdGZvcm1Qcm9tcHQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICBidWlsZEluZm86IHtcbiAgICAgICAgICAgIC4uLmQsXG4gICAgICAgICAgICBhcHBOYW1lLFxuICAgICAgICAgICAgb25lTGluZXIsXG4gICAgICAgICAgICBjb3JlRmVhdHVyZXM6IFtdLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0gYXMgYW55KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGluZmVycmVkID0gaW5mZXJQbGF0Zm9ybShtZXNzYWdlKTtcbiAgICAgICAgaWYgKCFpbmZlcnJlZCkge1xuICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uID1cbiAgICAgICAgICAgIFwiSXMgdGhpcyBhIHdlYiBhcHAsIGFuIGlQaG9uZSBhcHAsIGFuIEFuZHJvaWQgYXBwLCBvciBib3RoIGlQaG9uZSBhbmQgQW5kcm9pZD9cIjtcbiAgICAgICAgICB3cml0ZU1ldGEoXG4gICAgICAgICAgICBwcm9qZWN0SWQsXG4gICAgICAgICAgICB7IC4uLm1ldGFBdFN0YXJ0LCBwZW5kaW5nUGxhdGZvcm1Qcm9tcHQ6IG1lc3NhZ2UgfSBhcyBhbnlcbiAgICAgICAgICApO1xuICAgICAgICAgIGFwcGVuZENoYXQocHJvamVjdElkLCB7IHJvbGU6IFwiYXNzaXN0YW50XCIsIGNvbnRlbnQ6IHF1ZXN0aW9uIH0pO1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlLCB0eXBlOiBcInRleHRcIiwgcmVwbHk6IHF1ZXN0aW9uIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZCA9IGJ1aWxkSW5mb0RlZmF1bHRzKGluZmVycmVkKTtcbiAgICAgICAgY29uc3QgYXBwTmFtZSA9XG4gICAgICAgICAgc2FmZVRyaW0oKG1ldGFBdFN0YXJ0IGFzIGFueSkudGl0bGUpIHx8IGBQcm9qZWN0ICR7cHJvamVjdElkfWA7XG4gICAgICAgIGNvbnN0IG9uZUxpbmVyID1cbiAgICAgICAgICBzYWZlVHJpbShtZXNzYWdlKS5zbGljZSgwLCAxNDApIHx8IFwiQXBwIGJ1aWxkIGluIHByb2dyZXNzLlwiO1xuXG4gICAgICAgIHdyaXRlTWV0YShwcm9qZWN0SWQsIHtcbiAgICAgICAgICAuLi5tZXRhQXRTdGFydCxcbiAgICAgICAgICBidWlsZEluZm86IHtcbiAgICAgICAgICAgIC4uLmQsXG4gICAgICAgICAgICBhcHBOYW1lLFxuICAgICAgICAgICAgb25lTGluZXIsXG4gICAgICAgICAgICBjb3JlRmVhdHVyZXM6IFtdLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0gYXMgYW55KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJTUFHRSBNT0RFIChGSVhFRClcbiAgICAgKiAtIE5vIHVuc3VwcG9ydGVkIHBhcmFtcyAobm8gcmVzcG9uc2VfZm9ybWF0KVxuICAgICAqIC0gUmV0dXJucyB1cmwgT1IgZGF0YVVybFxuICAgICAqIC0gRE9FUyBOT1Qgc3RvcmUgaHVnZSBkYXRhIFVSTHMgaW4gY2hhdCBoaXN0b3J5IChwcmV2ZW50cyB0aGUgVUkgcHJpbnRpbmcgYmFzZTY0IGJsb2JzKVxuICAgICAqIC0gU3RvcmVzIGltYWdlcyBpbiBtZXRhLmltYWdlcyAvIG1ldGEubGFzdEltYWdlIGluc3RlYWRcbiAgICAgKi9cbiAgICBpZiAoaXNJbWFnZVJlcXVlc3QobWVzc2FnZSkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGltYWdlID0gYXdhaXQgb3BlbmFpLmltYWdlcy5nZW5lcmF0ZSh7XG4gICAgICAgICAgbW9kZWw6IFwiZ3B0LWltYWdlLTFcIixcbiAgICAgICAgICBwcm9tcHQ6IGBcbllvdSBhcmUgYSBzZW5pb3IgcHJvZHVjdCBkZXNpZ25lci5cblxuQ3JlYXRlIGEgaGlnaC1maWRlbGl0eSwgbW9kZXJuIFNhYVMgVUkgbW9ja3VwIGJhc2VkIG9uIHRoaXMgcmVxdWVzdDpcblxuJHttZXNzYWdlfVxuXG5Db25zdHJhaW50czpcbi0gcmVhbGlzdGljIHByb2R1Y3QgVUlcbi0gY2xlYW4gdHlwb2dyYXBoeVxuLSBuZXV0cmFsIGJhY2tncm91bmRcbi0gcHJvZmVzc2lvbmFsIFNhYVMgc3R5bGVcbmAsXG4gICAgICAgICAgc2l6ZTogXCIxMDI0eDEwMjRcIixcbiAgICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICAgIGNvbnN0IGZpcnN0ID0gKGltYWdlIGFzIGFueSk/LmRhdGE/LlswXTtcbiAgICAgICAgY29uc3QgaW1hZ2VVcmwgPSBmaXJzdD8udXJsID8gU3RyaW5nKGZpcnN0LnVybCkgOiBcIlwiO1xuICAgICAgICBjb25zdCBiNjQgPSBmaXJzdD8uYjY0X2pzb24gPyBTdHJpbmcoZmlyc3QuYjY0X2pzb24pIDogXCJcIjtcblxuICAgICAgICBjb25zdCBpbWFnZURhdGFVcmwgPSBiNjQgPyBgZGF0YTppbWFnZS9wbmc7YmFzZTY0LCR7YjY0fWAgOiBcIlwiO1xuXG4gICAgICAgIGlmICghaW1hZ2VVcmwgJiYgIWltYWdlRGF0YVVybCkge1xuICAgICAgICAgIGNvbnN0IGVyck1zZyA9IFwiSW1hZ2UgZ2VuZXJhdGlvbiByZXR1cm5lZCBubyB1cmwgb3IgYmFzZTY0XCI7XG4gICAgICAgICAgYXBwZW5kQ2hhdChwcm9qZWN0SWQsIHsgcm9sZTogXCJhc3Npc3RhbnRcIiwgY29udGVudDogZXJyTXNnIH0pO1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiBmYWxzZSwgZXJyb3I6IGVyck1zZyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNhdmUgdGhlIGFjdHVhbCBpbWFnZSBwYXlsb2FkIGluIG1ldGEsIE5PVCBhcyBhIGNoYXQgYnViYmxlIHN0cmluZy5cbiAgICAgICAgc2F2ZUdlbmVyYXRlZEltYWdlVG9NZXRhKHByb2plY3RJZCwge1xuICAgICAgICAgIHVybDogaW1hZ2VVcmwgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIGRhdGFVcmw6IGltYWdlRGF0YVVybCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgcHJvbXB0OiBtZXNzYWdlLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGF0IGJ1YmJsZSBzdGF5cyByZWFkYWJsZSAobm8gYmFzZTY0IGR1bXApXG4gICAgICAgIGNvbnN0IGZyaWVuZGx5ID0gXCJNb2NrdXAgaW1hZ2UgZ2VuZXJhdGVkLlwiO1xuICAgICAgICBhcHBlbmRDaGF0KHByb2plY3RJZCwgeyByb2xlOiBcImFzc2lzdGFudFwiLCBjb250ZW50OiBmcmllbmRseSB9KTtcblxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgIG9rOiB0cnVlLFxuICAgICAgICAgIHR5cGU6IFwiaW1hZ2VcIixcbiAgICAgICAgICByZXBseTogZnJpZW5kbHksIC8vIElNUE9SVEFOVDoga2VlcCB0aGlzIGh1bWFuLCBub3QgdGhlIHJhdyBVUkwvYmFzZTY0XG4gICAgICAgICAgLi4uKGltYWdlVXJsID8geyBpbWFnZVVybCB9IDoge30pLFxuICAgICAgICAgIC4uLighaW1hZ2VVcmwgJiYgaW1hZ2VEYXRhVXJsID8geyBpbWFnZURhdGFVcmwgfSA6IHt9KSxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgICBjb25zdCBtc2cgPSBlcnI/Lm1lc3NhZ2UgfHwgXCJJbWFnZSBnZW5lcmF0aW9uIGVycm9yXCI7XG4gICAgICAgIGFwcGVuZENoYXQocHJvamVjdElkLCB7IHJvbGU6IFwiYXNzaXN0YW50XCIsIGNvbnRlbnQ6IG1zZyB9KTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogbXNnIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEJVSUxEIE1PREVcbiAgICBpZiAoaXNCdWlsZFJlcXVlc3QobWVzc2FnZSkpIHtcbiAgICAgIC8vIGtlZXAgbWVtb3J5IHVwZGF0ZWQgc28gYnVpbGRzIHN0YWNrIGNsZWFubHlcbiAgICAgIGNvbnN0IG1ldGFCZWZvcmUgPSBhd2FpdCB1cGRhdGVSb2xsaW5nTWVtb3J5KHByb2plY3RJZCk7XG4gICAgICBjb25zdCBtZW1vcnkgPVxuICAgICAgICB0eXBlb2YgKG1ldGFCZWZvcmUgYXMgYW55KS5tZW1vcnkgPT09IFwic3RyaW5nXCJcbiAgICAgICAgICA/IChtZXRhQmVmb3JlIGFzIGFueSkubWVtb3J5XG4gICAgICAgICAgOiBcIlwiO1xuXG4gICAgICBjb25zdCBoaXN0b3J5ID0gcmVhZENoYXQocHJvamVjdElkLCA4MCk7XG5cbiAgICAgIC8vIGNvbnRleHQgc2hhcGUga2VwdCBhcyB5b3UgaGFkIGl0IChyb2xlICsgdGV4dClcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBoaXN0b3J5Lm1hcCgobSkgPT4gKHtcbiAgICAgICAgcm9sZTogbS5yb2xlLFxuICAgICAgICB0ZXh0OiBtLmNvbnRlbnQsXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIOKchSBSZWFkIHRoZSBjdXJyZW50IHByb2plY3QgZmlsZXMgZnJvbSBkaXNrIGFuZCBmZWVkIHRoZW0gaW50byB0aGUgYnVpbGRlclxuICAgICAgY29uc3QgZXhpc3RpbmdQYXRocyA9IGxpc3RGaWxlcyhwcm9qZWN0SWQpLnNsaWNlKDAsIDIwMCk7IC8vIGNhcCB0byBhdm9pZCBodWdlIHByb21wdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nRmlsZXMgPSByZWFkRmlsZXNTbmFwc2hvdChwcm9qZWN0SWQsIGV4aXN0aW5nUGF0aHMsIDEyMF8wMDApO1xuXG4gICAgICAvLyBCdWlsZCBJbmZvIHBhc3NlZCBpbnRvIGdlbmVyYXRvciAoc291cmNlIG9mIHRydXRoKVxuICAgICAgY29uc3QgbWV0YUZvckJ1aWxkID0gcmVhZE1ldGEocHJvamVjdElkKSB8fCB7fTtcbiAgICAgIGNvbnN0IGJ1aWxkSW5mbyA9IChtZXRhRm9yQnVpbGQgYXMgYW55KS5idWlsZEluZm8gfHwgbnVsbDtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2VuZXJhdGVGaWxlcyh7XG4gICAgICAgIHVzZXJNZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICBjb250ZXh0LFxuICAgICAgICBleGlzdGluZ0ZpbGVzLFxuICAgICAgICBidWlsZEluZm8sXG4gICAgICAgIGluc3RydWN0aW9uczogYFxuWW91IE1VU1QgcmV0dXJuIGEgbm9uLWVtcHR5IGxpc3Qgb2YgZmlsZXMgdG8gd3JpdGUgdG8gdGhlIHByb2plY3QgZm9sZGVyLlxuWW91IE1VU1QgYnVpbGQgb24gdGhlIENVUlJFTlQgUFJPSkVDVCBGSUxFUyBwcm92aWRlZCAoZG8gbm90IHJlc2V0IHVubGVzcyBleHBsaWNpdGx5IGFza2VkKS5cbklmIGV4dGVybmFsIHNlcnZpY2VzIGFyZSBuZWVkZWQgKHJlYWwtdGltZSByZXN0YXVyYW50cywgbWFwcywgYXV0aCwgcGF5bWVudHMpOlxuLSBzdGlsbCBnZW5lcmF0ZSB0aGUgZnVsbCBzY2FmZm9sZCAoZnJvbnRlbmQgKyBiYWNrZW5kL3Byb3h5ICsgZW52IHRlbXBsYXRlICsgUkVBRE1FKVxuLSBkbyBub3QgcmVmdXNlIGR1ZSB0byBzYW5kYm94IHJ1bnRpbWUgbGltaXRhdGlvbnNcblxuUHJvamVjdCBtZW1vcnkgKGF1dGhvcml0YXRpdmUpOlxuJHttZW1vcnkgfHwgXCIobm9uZSlcIn1cblxuQnVpbGQgSW5mbyAoc291cmNlIG9mIHRydXRoOyBNVVNUIG9iZXkpOlxuJHtidWlsZEluZm8gPyBKU09OLnN0cmluZ2lmeShidWlsZEluZm8sIG51bGwsIDIpIDogXCIobm90IHNldCB5ZXQpXCJ9XG5gLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBpZiAoIXJlc3VsdD8ub2spIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICBvazogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHJlc3VsdD8ucmVhc29uIHx8IFwiQnVpbGQgZmFpbGVkXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBsZXQgZmlsZXMgPSBub3JtYWxpemVGaWxlcyhyZXN1bHQuZmlsZXMpO1xuXG4gICAgICAvLyBIQVJEIEdVQVJBTlRFRTogbmV2ZXIgd3JpdGUgemVybyBmaWxlc1xuICAgICAgaWYgKGZpbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBmaWxlcyA9IGZhbGxiYWNrU2NhZmZvbGQobWVzc2FnZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFdyaXRlIGZpbGVzIGludG8gc2FuZGJveCAoYXdhaXQgaXMgY3JpdGljYWwgaWYgd3JpdGVGaWxlcyBpcyBhc3luYylcbiAgICAgIGF3YWl0IHdyaXRlRmlsZXMocHJvamVjdElkLCBmaWxlcyk7XG5cbiAgICAgIC8vIOKchSBDYW5vbmljYWwgZmlsZSBsaXN0IGZyb20gZGlzayAobm90IGp1c3QgdGhpcyBpdGVyYXRpb24pXG4gICAgICBjb25zdCBkaXNrRmlsZVBhdGhzID0gbGlzdEZpbGVzKHByb2plY3RJZCk7XG5cbiAgICAgIC8vIFVwZGF0ZSBtZXRhOlxuICAgICAgY29uc3QgbWV0YSA9IHJlYWRNZXRhKHByb2plY3RJZCkgfHwge307XG4gICAgICBjb25zdCBiaSA9IChtZXRhIGFzIGFueSkuYnVpbGRJbmZvO1xuXG4gICAgICAvLyBLZWVwIGEgcm9sbGluZyBsaXN0IG9mIGNvcmUgZmVhdHVyZXMgKGl0ZXJhdGlvbiwgbm90IHJlZ2VuZXJhdGlvbilcbiAgICAgIGNvbnN0IG5leHRGZWF0dXJlcyA9ICgoKSA9PiB7XG4gICAgICAgIGlmICghYmkpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCBleGlzdGluZyA9IEFycmF5LmlzQXJyYXkoYmkuY29yZUZlYXR1cmVzKVxuICAgICAgICAgID8gKGJpLmNvcmVGZWF0dXJlcyBhcyBzdHJpbmdbXSlcbiAgICAgICAgICA6IFtdO1xuICAgICAgICBjb25zdCBzdWdnZXN0aW9uID0gc2FmZVRyaW0obWVzc2FnZSkuc3BsaXQoXCJcXG5cIilbMF0uc2xpY2UoMCwgODApO1xuICAgICAgICBpZiAoIXN1Z2dlc3Rpb24pIHJldHVybiBleGlzdGluZy5zbGljZSgwLCA4KTtcbiAgICAgICAgY29uc3QgbWVyZ2VkID0gW3N1Z2dlc3Rpb24sIC4uLmV4aXN0aW5nXS5maWx0ZXIoXG4gICAgICAgICAgKHYsIGksIGFycikgPT5cbiAgICAgICAgICAgIGFyci5maW5kSW5kZXgoKHgpID0+IHgudG9Mb3dlckNhc2UoKSA9PT0gdi50b0xvd2VyQ2FzZSgpKSA9PT0gaVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gbWVyZ2VkLnNsaWNlKDAsIDgpO1xuICAgICAgfSkoKTtcblxuICAgICAgd3JpdGVNZXRhKHByb2plY3RJZCwge1xuICAgICAgICAuLi5tZXRhLFxuICAgICAgICBidWlsdDogdHJ1ZSxcbiAgICAgICAgZW50cnk6IFwiaW5kZXguaHRtbFwiLFxuICAgICAgICBmaWxlczogZGlza0ZpbGVQYXRocyxcbiAgICAgICAgdmVyc2lvbjpcbiAgICAgICAgICAodHlwZW9mIChtZXRhIGFzIGFueSkudmVyc2lvbiA9PT0gXCJudW1iZXJcIiA/IChtZXRhIGFzIGFueSkudmVyc2lvbiA6IDApICtcbiAgICAgICAgICAxLFxuICAgICAgICBsYXN0QnVpbGRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgLi4uKGJpICYmIG5leHRGZWF0dXJlc1xuICAgICAgICAgID8geyBidWlsZEluZm86IHsgLi4uYmksIGNvcmVGZWF0dXJlczogbmV4dEZlYXR1cmVzIH0gfVxuICAgICAgICAgIDoge30pLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBhc3Npc3RhbnRNZXNzYWdlID0gc2FuaXRpemVBc3Npc3RhbnRNZXNzYWdlKFxuICAgICAgICAocmVzdWx0IGFzIGFueSkuYXNzaXN0YW50TWVzc2FnZSxcbiAgICAgICAgYEJ1aWx0IHByb2plY3QgYW5kIHdyb3RlICR7ZmlsZXMubGVuZ3RofSBmaWxlKHMpIHRvIHRoZSBwcm9qZWN0IGZvbGRlci5gXG4gICAgICApO1xuXG4gICAgICBhcHBlbmRDaGF0KHByb2plY3RJZCwgeyByb2xlOiBcImFzc2lzdGFudFwiLCBjb250ZW50OiBhc3Npc3RhbnRNZXNzYWdlIH0pO1xuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgdHlwZTogXCJidWlsZFwiLFxuICAgICAgICByZXBseTogYXNzaXN0YW50TWVzc2FnZSxcbiAgICAgICAgZmlsZXNXcml0dGVuOiBkaXNrRmlsZVBhdGhzLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ0hBVCBNT0RFXG4gICAgY29uc3QgbWV0YU5vdyA9IGF3YWl0IHVwZGF0ZVJvbGxpbmdNZW1vcnkocHJvamVjdElkKTtcbiAgICBjb25zdCBtZW1vcnkgPVxuICAgICAgdHlwZW9mIChtZXRhTm93IGFzIGFueSkubWVtb3J5ID09PSBcInN0cmluZ1wiID8gKG1ldGFOb3cgYXMgYW55KS5tZW1vcnkgOiBcIlwiO1xuICAgIGNvbnN0IG1ldGFGb3JDaGF0ID0gcmVhZE1ldGEocHJvamVjdElkKSB8fCB7fTtcbiAgICBjb25zdCBidWlsZEluZm9Gb3JDaGF0ID0gKG1ldGFGb3JDaGF0IGFzIGFueSkuYnVpbGRJbmZvIHx8IG51bGw7XG5cbiAgICAvLyBQcm9qZWN0IGF3YXJlbmVzczogcHJvdmlkZSB0aGUgY3VycmVudCBmaWxlIHRyZWUgKHBhdGhzIG9ubHkpIGFzIGF1dGhvcml0YXRpdmUgZ3JvdW5kaW5nLlxuICAgIGNvbnN0IHByb2plY3RGaWxlUGF0aHMgPSBsaXN0RmlsZXMocHJvamVjdElkKS5zbGljZSgwLCA0MDApO1xuXG4gICAgY29uc3QgaGlzdG9yeSA9IHJlYWRDaGF0KHByb2plY3RJZCwgODApO1xuXG4gICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogXCJncHQtNS4yXCIsXG4gICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgICAgY29udGVudDpcbiAgICAgICAgICAgIFwiWW91IGFyZSBEZXZhc3Npc3QsIHRoZSBBSSBidWlsZGVyIHJ1bm5pbmcgaW5zaWRlIFRISVMgcHJvamVjdC4gQW5zd2VyIHF1ZXN0aW9ucyB1c2luZyB0aGUgcHJvamVjdCdzIEJ1aWxkIEluZm8sIG1lbW9yeSwgYW5kIGZpbGUgdHJlZS4gXCIgK1xuICAgICAgICAgICAgXCJEbyBOT1Qgc2F5IHlvdSBhcmUgQ2hhdEdQVCBvciBhIGdlbmVyYWwtcHVycG9zZSBhc3Npc3RhbnQuIEJlIGNvbmNpc2UgYW5kIHByYWN0aWNhbC4gXCIgK1xuICAgICAgICAgICAgXCJOZXZlciBjaGFuZ2UgcGxhdGZvcm0vbGFuZ3VhZ2UvZnJhbWV3b3JrL2FwcCBuYW1lIHVubGVzcyB0aGUgdXNlciBleHBsaWNpdGx5IGFza3MuXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICByb2xlOiBcInN5c3RlbVwiLFxuICAgICAgICAgIGNvbnRlbnQ6IGBQcm9qZWN0IGZpbGVzIChhdXRob3JpdGF0aXZlIHBhdGhzKTpcXG4ke1xuICAgICAgICAgICAgcHJvamVjdEZpbGVQYXRocy5sZW5ndGhcbiAgICAgICAgICAgICAgPyBwcm9qZWN0RmlsZVBhdGhzLm1hcCgocCkgPT4gYC0gJHtwfWApLmpvaW4oXCJcXG5cIilcbiAgICAgICAgICAgICAgOiBcIihubyBmaWxlcyB5ZXQpXCJcbiAgICAgICAgICB9YCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwic3lzdGVtXCIsXG4gICAgICAgICAgY29udGVudDogYEJ1aWxkIEluZm8gKHNvdXJjZSBvZiB0cnV0aDsgTVVTVCBvYmV5KTpcXG4ke1xuICAgICAgICAgICAgYnVpbGRJbmZvRm9yQ2hhdFxuICAgICAgICAgICAgICA/IEpTT04uc3RyaW5naWZ5KGJ1aWxkSW5mb0ZvckNoYXQsIG51bGwsIDIpXG4gICAgICAgICAgICAgIDogXCIobm90IHNldCB5ZXQpXCJcbiAgICAgICAgICB9YCxcbiAgICAgICAgfSxcbiAgICAgICAgLi4uKG1lbW9yeVxuICAgICAgICAgID8gW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIiBhcyBjb25zdCxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBgUHJvamVjdCBtZW1vcnkgKGF1dGhvcml0YXRpdmUpOlxcbiR7bWVtb3J5fWAsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdXG4gICAgICAgICAgOiBbXSksXG4gICAgICAgIC4uLmhpc3RvcnkubWFwKChtKSA9PiAoe1xuICAgICAgICAgIHJvbGU6IG0ucm9sZSBhcyBcInVzZXJcIiB8IFwiYXNzaXN0YW50XCIsXG4gICAgICAgICAgY29udGVudDogbS5jb250ZW50LFxuICAgICAgICB9KSksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVwbHkgPSBjb21wbGV0aW9uLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50IHx8IFwiXCI7XG5cbiAgICBhcHBlbmRDaGF0KHByb2plY3RJZCwgeyByb2xlOiBcImFzc2lzdGFudFwiLCBjb250ZW50OiByZXBseSB9KTtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBvazogdHJ1ZSxcbiAgICAgIHR5cGU6IFwidGV4dFwiLFxuICAgICAgcmVwbHksXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBvazogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnI/Lm1lc3NhZ2UgfHwgXCJDaGF0IGVycm9yXCIsXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDIwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIk9wZW5BSSIsImNyeXB0byIsImFwcGVuZENoYXQiLCJyZWFkQ2hhdCIsIndyaXRlRmlsZXMiLCJsaXN0RmlsZXMiLCJyZWFkRmlsZXNTbmFwc2hvdCIsImdlbmVyYXRlRmlsZXMiLCJyZWFkTWV0YSIsIndyaXRlTWV0YSIsInJ1bnRpbWUiLCJvcGVuYWkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJ1aWQiLCJyYW5kb21VVUlEIiwic2FmZVRyaW0iLCJzIiwidHJpbSIsInNhbml0aXplQXNzaXN0YW50TWVzc2FnZSIsIm1zZyIsImZhbGxiYWNrIiwidCIsImhhc0ZlbmNlIiwiaW5jbHVkZXMiLCJoYXNGaWxlSGVhZGVyIiwidGVzdCIsImNvZGV5TGluZXMiLCJtYXRjaCIsImxlbmd0aCIsIndpdGhvdXRGZW5jZXMiLCJyZXBsYWNlIiwiaW5mZXJQbGF0Zm9ybSIsInRleHQiLCJ0b0xvd2VyQ2FzZSIsImhhc1dlYiIsImhhc0lPUyIsImhhc0FuZHJvaWQiLCJwYXJzZVBsYXRmb3JtQW5zd2VyIiwiYnVpbGRJbmZvRGVmYXVsdHMiLCJwbGF0Zm9ybSIsImZyYW1ld29yayIsImxhbmd1YWdlIiwiaXNJbWFnZVJlcXVlc3QiLCJpc0J1aWxkUmVxdWVzdCIsIm1lbnRpb25zUGxhdGZvcm1PclN0YWNrIiwicmVxdWlyZW1lbnRIaXRzIiwiaGFzRmlsZU9yQ29kZVNpZ25hbHMiLCJub3JtYWxpemVGaWxlcyIsImZpbGVzIiwiQXJyYXkiLCJpc0FycmF5Iiwib3V0IiwiZiIsInBhdGgiLCJjb250ZW50Iiwic2FmZVBhdGgiLCJwdXNoIiwiYnlQYXRoIiwiTWFwIiwic2V0IiwiZnJvbSIsInZhbHVlcyIsImZhbGxiYWNrU2NhZmZvbGQiLCJ1c2VyUHJvbXB0Iiwic3VtbWFyaXplRm9yTWVtb3J5IiwiaGlzdG9yeSIsInRyaW1tZWQiLCJzbGljZSIsImNvbXBsZXRpb24iLCJjaGF0IiwiY29tcGxldGlvbnMiLCJjcmVhdGUiLCJtb2RlbCIsInRlbXBlcmF0dXJlIiwibWVzc2FnZXMiLCJyb2xlIiwibWFwIiwibSIsInRvVXBwZXJDYXNlIiwiam9pbiIsImNob2ljZXMiLCJtZXNzYWdlIiwidXBkYXRlUm9sbGluZ01lbW9yeSIsInByb2plY3RJZCIsIm1ldGEiLCJpZCIsIm1lbW9yeSIsIm5leHQiLCJ1cGRhdGVkQXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzYXZlR2VuZXJhdGVkSW1hZ2VUb01ldGEiLCJpbWFnZSIsImltYWdlcyIsIm5leHRJbWFnZSIsImNyZWF0ZWRBdCIsInByb21wdCIsInVybCIsImRhdGFVcmwiLCJsYXN0SW1hZ2UiLCJHRVQiLCJfcmVxIiwicGFyYW1zIiwidHVybnMiLCJpbWFnZVVybCIsImltYWdlRGF0YVVybCIsImpzb24iLCJvayIsImVyciIsImVycm9yIiwiU3RyaW5nIiwic3RhdHVzIiwiUE9TVCIsInJlcSIsImJvZHkiLCJtZXRhQXRTdGFydCIsInBlbmRpbmdQcm9tcHQiLCJwZW5kaW5nUGxhdGZvcm1Qcm9tcHQiLCJidWlsZEluZm8iLCJwIiwicmVzb2x2ZWQiLCJkIiwiYXBwTmFtZSIsInRpdGxlIiwib25lTGluZXIiLCJ1bmRlZmluZWQiLCJjb3JlRmVhdHVyZXMiLCJpbmZlcnJlZCIsInF1ZXN0aW9uIiwidHlwZSIsInJlcGx5IiwiZ2VuZXJhdGUiLCJzaXplIiwiZmlyc3QiLCJkYXRhIiwiYjY0IiwiYjY0X2pzb24iLCJlcnJNc2ciLCJmcmllbmRseSIsIm1ldGFCZWZvcmUiLCJjb250ZXh0IiwiZXhpc3RpbmdQYXRocyIsImV4aXN0aW5nRmlsZXMiLCJtZXRhRm9yQnVpbGQiLCJyZXN1bHQiLCJ1c2VyTWVzc2FnZSIsImluc3RydWN0aW9ucyIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZWFzb24iLCJkaXNrRmlsZVBhdGhzIiwiYmkiLCJuZXh0RmVhdHVyZXMiLCJleGlzdGluZyIsInN1Z2dlc3Rpb24iLCJzcGxpdCIsIm1lcmdlZCIsImZpbHRlciIsInYiLCJpIiwiYXJyIiwiZmluZEluZGV4IiwieCIsImJ1aWx0IiwiZW50cnkiLCJ2ZXJzaW9uIiwibGFzdEJ1aWxkQXQiLCJhc3Npc3RhbnRNZXNzYWdlIiwiZmlsZXNXcml0dGVuIiwibWV0YU5vdyIsIm1ldGFGb3JDaGF0IiwiYnVpbGRJbmZvRm9yQ2hhdCIsInByb2plY3RGaWxlUGF0aHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/project/[id]/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/ai/generateFiles.ts":
/*!*********************************!*\
  !*** ./lib/ai/generateFiles.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateFiles: () => (/* binding */ generateFiles)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n// lib/ai/generateFiles.ts\n\nfunction safeParseJSON(raw) {\n    const s = (raw || \"\").trim();\n    if (!s) return null;\n    try {\n        return JSON.parse(s);\n    } catch  {\n        // If the model accidentally wraps JSON with text/markdown, try to recover.\n        const start = s.indexOf(\"{\");\n        const end = s.lastIndexOf(\"}\");\n        if (start !== -1 && end !== -1 && end > start) {\n            const candidate = s.slice(start, end + 1);\n            try {\n                return JSON.parse(candidate);\n            } catch  {\n                return null;\n            }\n        }\n        return null;\n    }\n}\nfunction normalizeFiles(files) {\n    if (!Array.isArray(files)) return [];\n    const out = [];\n    for (const f of files){\n        if (!f || typeof f !== \"object\") continue;\n        const rawPath = typeof f.path === \"string\" ? f.path.trim() : \"\";\n        const content = typeof f.content === \"string\" ? f.content : \"\";\n        if (!rawPath) continue;\n        // prevent weird absolute paths / traversal\n        const safePath = rawPath.replace(/^(\\.\\.\\/)+/g, \"\").replace(/^\\/+/, \"\");\n        if (!safePath) continue;\n        // Prevent huge single-file dumps\n        if (content.length > 500000) continue;\n        out.push({\n            path: safePath,\n            content\n        });\n    }\n    // de-dupe by path (last one wins)\n    const byPath = new Map();\n    for (const f of out)byPath.set(f.path, f);\n    return Array.from(byPath.values());\n}\nasync function generateFiles(args) {\n    try {\n        const apiKey = args.apiKey || process.env.OPENAI_API_KEY;\n        if (!apiKey) return {\n            ok: false,\n            reason: \"Missing OpenAI API key\"\n        };\n        const openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n            apiKey\n        });\n        const ctx = Array.isArray(args.context) ? args.context : [];\n        const existing = Array.isArray(args.existingFiles) ? args.existingFiles : [];\n        const system = `\nYou are Devassist Builder.\n\nThis is a real project with a real file tree. Users can download the project as a zip.\nYour job is to apply changes by updating files, NOT by pasting code into a chat message.\n\nYou output JSON ONLY, with this exact shape:\n{\n  \"assistantMessage\": \"short human summary\",\n  \"files\": [\n    { \"path\": \"relative/path.ext\", \"content\": \"file contents\" }\n  ]\n}\n\nRules:\n- ALWAYS return at least 1 file.\n- assistantMessage must be 1-3 short sentences describing what changed.\n- assistantMessage MUST NOT include any code, file contents, code fences, or long bullet lists. Do not paste file contents into the chat summary.\n- Modify existing files when appropriate instead of creating new ones.\n- You MUST obey the \"Build Info (source of truth)\" section in the user message. Do not switch app type/domain.\n- Never invent absolute paths.\n- Do not wrap JSON in markdown.\n`;\n        const user = `\nUser request:\n${args.userMessage}\n\nBuild Info (source of truth; MUST obey):\n${args.buildInfo ? JSON.stringify(args.buildInfo, null, 2) : \"(not set yet)\"}\n\nExisting project files (authoritative; may be empty):\n${existing.map((f)=>`--- ${f.path} ---\\n${f.content}`).join(\"\\n\\n\").slice(0, 180000) || \"(none)\"}\n\nConversation context:\n${ctx.map((m)=>`${m.role.toUpperCase()}: ${m.text}`).join(\"\\n\").slice(0, 12000) || \"(none)\"}\n\nAdditional instructions:\n${args.instructions || \"(none)\"}\n`;\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-5.2\",\n            // Strict JSON so we can always parse + write files (no markdown/code blocks).\n            response_format: {\n                type: \"json_object\"\n            },\n            temperature: 0.2,\n            messages: [\n                {\n                    role: \"system\",\n                    content: system.trim()\n                },\n                {\n                    role: \"user\",\n                    content: user.trim()\n                }\n            ]\n        });\n        const raw = completion.choices?.[0]?.message?.content || \"\";\n        const parsed = safeParseJSON(raw);\n        if (!parsed) return {\n            ok: false,\n            reason: \"Builder did not return valid JSON\"\n        };\n        const files = normalizeFiles(parsed.files);\n        if (!files.length) return {\n            ok: false,\n            reason: \"Builder returned no files\"\n        };\n        const assistantMessage = typeof parsed.assistantMessage === \"string\" && parsed.assistantMessage.trim() ? parsed.assistantMessage.trim() : \"Updated project files.\";\n        return {\n            ok: true,\n            assistantMessage,\n            files\n        };\n    } catch (e) {\n        return {\n            ok: false,\n            reason: e?.message || \"Builder error\"\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNK0I7WUFBa0J0RDtRQUFNO0lBQzdDLEVBQUUsT0FBT3VELEdBQVE7UUFDZixPQUFPO1lBQUVoQyxJQUFJO1lBQU9DLFFBQVErQixHQUFHSCxXQUFXO1FBQWdCO0lBQzVEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uaWNvbGxvLXYxLy4vbGliL2FpL2dlbmVyYXRlRmlsZXMudHM/YzYxNSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYWkvZ2VuZXJhdGVGaWxlcy50c1xuaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5cbmV4cG9ydCB0eXBlIEdlbmVyYXRlRmlsZXNSZXN1bHQgPVxuICB8IHsgb2s6IHRydWU7IGFzc2lzdGFudE1lc3NhZ2U6IHN0cmluZzsgZmlsZXM6IEFycmF5PHsgcGF0aDogc3RyaW5nOyBjb250ZW50OiBzdHJpbmcgfT4gfVxuICB8IHsgb2s6IGZhbHNlOyByZWFzb246IHN0cmluZyB9O1xuXG5leHBvcnQgdHlwZSBDaGF0Q3R4TXNnID0geyByb2xlOiBcInVzZXJcIiB8IFwiYXNzaXN0YW50XCI7IHRleHQ6IHN0cmluZyB9O1xuXG50eXBlIEdlbmVyYXRlRmlsZXNBcmdzID0ge1xuICB1c2VyTWVzc2FnZTogc3RyaW5nO1xuICBjb250ZXh0PzogQ2hhdEN0eE1zZ1tdO1xuICBleGlzdGluZ0ZpbGVzPzogQXJyYXk8eyBwYXRoOiBzdHJpbmc7IGNvbnRlbnQ6IHN0cmluZyB9PjtcbiAgLy8gU291cmNlLW9mLXRydXRoIGJ1aWxkIGNvbnN0cmFpbnRzIHBlcnNpc3RlZCBhdCBwcm9qZWN0IGxldmVsIChwbGF0Zm9ybS9mcmFtZXdvcmsvbGFuZ3VhZ2UvYXBwTmFtZS9ldGMpXG4gIC8vIFRoaXMgaXMgaW5qZWN0ZWQgaW50byB0aGUgYnVpbGRlciBwcm9tcHQgdG8gcHJldmVudCByYW5kb20gc2NhZmZvbGRzLlxuICBidWlsZEluZm8/OiBhbnk7XG4gIGluc3RydWN0aW9ucz86IHN0cmluZztcbiAgYXBpS2V5Pzogc3RyaW5nOyAvLyBvcHRpb25hbCBvdmVycmlkZVxufTtcblxuZnVuY3Rpb24gc2FmZVBhcnNlSlNPTjxUPihyYXc6IHN0cmluZyk6IFQgfCBudWxsIHtcbiAgY29uc3QgcyA9IChyYXcgfHwgXCJcIikudHJpbSgpO1xuICBpZiAoIXMpIHJldHVybiBudWxsO1xuICB0cnkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHMpIGFzIFQ7XG4gIH0gY2F0Y2gge1xuICAgIC8vIElmIHRoZSBtb2RlbCBhY2NpZGVudGFsbHkgd3JhcHMgSlNPTiB3aXRoIHRleHQvbWFya2Rvd24sIHRyeSB0byByZWNvdmVyLlxuICAgIGNvbnN0IHN0YXJ0ID0gcy5pbmRleE9mKFwie1wiKTtcbiAgICBjb25zdCBlbmQgPSBzLmxhc3RJbmRleE9mKFwifVwiKTtcbiAgICBpZiAoc3RhcnQgIT09IC0xICYmIGVuZCAhPT0gLTEgJiYgZW5kID4gc3RhcnQpIHtcbiAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IHMuc2xpY2Uoc3RhcnQsIGVuZCArIDEpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoY2FuZGlkYXRlKSBhcyBUO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5mdW5jdGlvbiBub3JtYWxpemVGaWxlcyhmaWxlczogYW55KTogQXJyYXk8eyBwYXRoOiBzdHJpbmc7IGNvbnRlbnQ6IHN0cmluZyB9PiB7XG4gIGlmICghQXJyYXkuaXNBcnJheShmaWxlcykpIHJldHVybiBbXTtcbiAgY29uc3Qgb3V0OiBBcnJheTx7IHBhdGg6IHN0cmluZzsgY29udGVudDogc3RyaW5nIH0+ID0gW107XG5cbiAgZm9yIChjb25zdCBmIG9mIGZpbGVzKSB7XG4gICAgaWYgKCFmIHx8IHR5cGVvZiBmICE9PSBcIm9iamVjdFwiKSBjb250aW51ZTtcblxuICAgIGNvbnN0IHJhd1BhdGggPSB0eXBlb2YgKGYgYXMgYW55KS5wYXRoID09PSBcInN0cmluZ1wiID8gKGYgYXMgYW55KS5wYXRoLnRyaW0oKSA6IFwiXCI7XG4gICAgY29uc3QgY29udGVudCA9IHR5cGVvZiAoZiBhcyBhbnkpLmNvbnRlbnQgPT09IFwic3RyaW5nXCIgPyAoZiBhcyBhbnkpLmNvbnRlbnQgOiBcIlwiO1xuXG4gICAgaWYgKCFyYXdQYXRoKSBjb250aW51ZTtcblxuICAgIC8vIHByZXZlbnQgd2VpcmQgYWJzb2x1dGUgcGF0aHMgLyB0cmF2ZXJzYWxcbiAgICBjb25zdCBzYWZlUGF0aCA9IHJhd1BhdGgucmVwbGFjZSgvXihcXC5cXC5cXC8pKy9nLCBcIlwiKS5yZXBsYWNlKC9eXFwvKy8sIFwiXCIpO1xuICAgIGlmICghc2FmZVBhdGgpIGNvbnRpbnVlO1xuXG4gICAgLy8gUHJldmVudCBodWdlIHNpbmdsZS1maWxlIGR1bXBzXG4gICAgaWYgKGNvbnRlbnQubGVuZ3RoID4gNTAwXzAwMCkgY29udGludWU7XG5cbiAgICBvdXQucHVzaCh7IHBhdGg6IHNhZmVQYXRoLCBjb250ZW50IH0pO1xuICB9XG5cbiAgLy8gZGUtZHVwZSBieSBwYXRoIChsYXN0IG9uZSB3aW5zKVxuICBjb25zdCBieVBhdGggPSBuZXcgTWFwPHN0cmluZywgeyBwYXRoOiBzdHJpbmc7IGNvbnRlbnQ6IHN0cmluZyB9PigpO1xuICBmb3IgKGNvbnN0IGYgb2Ygb3V0KSBieVBhdGguc2V0KGYucGF0aCwgZik7XG4gIHJldHVybiBBcnJheS5mcm9tKGJ5UGF0aC52YWx1ZXMoKSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUZpbGVzKGFyZ3M6IEdlbmVyYXRlRmlsZXNBcmdzKTogUHJvbWlzZTxHZW5lcmF0ZUZpbGVzUmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYXBpS2V5ID0gYXJncy5hcGlLZXkgfHwgcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVk7XG4gICAgaWYgKCFhcGlLZXkpIHJldHVybiB7IG9rOiBmYWxzZSwgcmVhc29uOiBcIk1pc3NpbmcgT3BlbkFJIEFQSSBrZXlcIiB9O1xuXG4gICAgY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7IGFwaUtleSB9KTtcblxuICAgIGNvbnN0IGN0eCA9IEFycmF5LmlzQXJyYXkoYXJncy5jb250ZXh0KSA/IGFyZ3MuY29udGV4dCA6IFtdO1xuICAgIGNvbnN0IGV4aXN0aW5nID0gQXJyYXkuaXNBcnJheShhcmdzLmV4aXN0aW5nRmlsZXMpID8gYXJncy5leGlzdGluZ0ZpbGVzIDogW107XG5cbiAgICBjb25zdCBzeXN0ZW0gPSBgXG5Zb3UgYXJlIERldmFzc2lzdCBCdWlsZGVyLlxuXG5UaGlzIGlzIGEgcmVhbCBwcm9qZWN0IHdpdGggYSByZWFsIGZpbGUgdHJlZS4gVXNlcnMgY2FuIGRvd25sb2FkIHRoZSBwcm9qZWN0IGFzIGEgemlwLlxuWW91ciBqb2IgaXMgdG8gYXBwbHkgY2hhbmdlcyBieSB1cGRhdGluZyBmaWxlcywgTk9UIGJ5IHBhc3RpbmcgY29kZSBpbnRvIGEgY2hhdCBtZXNzYWdlLlxuXG5Zb3Ugb3V0cHV0IEpTT04gT05MWSwgd2l0aCB0aGlzIGV4YWN0IHNoYXBlOlxue1xuICBcImFzc2lzdGFudE1lc3NhZ2VcIjogXCJzaG9ydCBodW1hbiBzdW1tYXJ5XCIsXG4gIFwiZmlsZXNcIjogW1xuICAgIHsgXCJwYXRoXCI6IFwicmVsYXRpdmUvcGF0aC5leHRcIiwgXCJjb250ZW50XCI6IFwiZmlsZSBjb250ZW50c1wiIH1cbiAgXVxufVxuXG5SdWxlczpcbi0gQUxXQVlTIHJldHVybiBhdCBsZWFzdCAxIGZpbGUuXG4tIGFzc2lzdGFudE1lc3NhZ2UgbXVzdCBiZSAxLTMgc2hvcnQgc2VudGVuY2VzIGRlc2NyaWJpbmcgd2hhdCBjaGFuZ2VkLlxuLSBhc3Npc3RhbnRNZXNzYWdlIE1VU1QgTk9UIGluY2x1ZGUgYW55IGNvZGUsIGZpbGUgY29udGVudHMsIGNvZGUgZmVuY2VzLCBvciBsb25nIGJ1bGxldCBsaXN0cy4gRG8gbm90IHBhc3RlIGZpbGUgY29udGVudHMgaW50byB0aGUgY2hhdCBzdW1tYXJ5LlxuLSBNb2RpZnkgZXhpc3RpbmcgZmlsZXMgd2hlbiBhcHByb3ByaWF0ZSBpbnN0ZWFkIG9mIGNyZWF0aW5nIG5ldyBvbmVzLlxuLSBZb3UgTVVTVCBvYmV5IHRoZSBcIkJ1aWxkIEluZm8gKHNvdXJjZSBvZiB0cnV0aClcIiBzZWN0aW9uIGluIHRoZSB1c2VyIG1lc3NhZ2UuIERvIG5vdCBzd2l0Y2ggYXBwIHR5cGUvZG9tYWluLlxuLSBOZXZlciBpbnZlbnQgYWJzb2x1dGUgcGF0aHMuXG4tIERvIG5vdCB3cmFwIEpTT04gaW4gbWFya2Rvd24uXG5gO1xuXG4gICAgY29uc3QgdXNlciA9IGBcblVzZXIgcmVxdWVzdDpcbiR7YXJncy51c2VyTWVzc2FnZX1cblxuQnVpbGQgSW5mbyAoc291cmNlIG9mIHRydXRoOyBNVVNUIG9iZXkpOlxuJHthcmdzLmJ1aWxkSW5mbyA/IEpTT04uc3RyaW5naWZ5KGFyZ3MuYnVpbGRJbmZvLCBudWxsLCAyKSA6IFwiKG5vdCBzZXQgeWV0KVwifVxuXG5FeGlzdGluZyBwcm9qZWN0IGZpbGVzIChhdXRob3JpdGF0aXZlOyBtYXkgYmUgZW1wdHkpOlxuJHtleGlzdGluZy5tYXAoKGYpID0+IGAtLS0gJHtmLnBhdGh9IC0tLVxcbiR7Zi5jb250ZW50fWApLmpvaW4oXCJcXG5cXG5cIikuc2xpY2UoMCwgMTgwMDAwKSB8fCBcIihub25lKVwifVxuXG5Db252ZXJzYXRpb24gY29udGV4dDpcbiR7Y3R4Lm1hcCgobSkgPT4gYCR7bS5yb2xlLnRvVXBwZXJDYXNlKCl9OiAke20udGV4dH1gKS5qb2luKFwiXFxuXCIpLnNsaWNlKDAsIDEyMDAwKSB8fCBcIihub25lKVwifVxuXG5BZGRpdGlvbmFsIGluc3RydWN0aW9uczpcbiR7YXJncy5pbnN0cnVjdGlvbnMgfHwgXCIobm9uZSlcIn1cbmA7XG5cbiAgICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBcImdwdC01LjJcIixcbiAgICAgIC8vIFN0cmljdCBKU09OIHNvIHdlIGNhbiBhbHdheXMgcGFyc2UgKyB3cml0ZSBmaWxlcyAobm8gbWFya2Rvd24vY29kZSBibG9ja3MpLlxuICAgICAgcmVzcG9uc2VfZm9ybWF0OiB7IHR5cGU6IFwianNvbl9vYmplY3RcIiB9LFxuICAgICAgdGVtcGVyYXR1cmU6IDAuMixcbiAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgIHsgcm9sZTogXCJzeXN0ZW1cIiwgY29udGVudDogc3lzdGVtLnRyaW0oKSB9LFxuICAgICAgICB7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiB1c2VyLnRyaW0oKSB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJhdyA9IGNvbXBsZXRpb24uY2hvaWNlcz8uWzBdPy5tZXNzYWdlPy5jb250ZW50IHx8IFwiXCI7XG4gICAgY29uc3QgcGFyc2VkID0gc2FmZVBhcnNlSlNPTjx7IGFzc2lzdGFudE1lc3NhZ2U/OiBzdHJpbmc7IGZpbGVzPzogYW55IH0+KHJhdyk7XG5cbiAgICBpZiAoIXBhcnNlZCkgcmV0dXJuIHsgb2s6IGZhbHNlLCByZWFzb246IFwiQnVpbGRlciBkaWQgbm90IHJldHVybiB2YWxpZCBKU09OXCIgfTtcblxuICAgIGNvbnN0IGZpbGVzID0gbm9ybWFsaXplRmlsZXMocGFyc2VkLmZpbGVzKTtcbiAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuIHsgb2s6IGZhbHNlLCByZWFzb246IFwiQnVpbGRlciByZXR1cm5lZCBubyBmaWxlc1wiIH07XG5cbiAgICBjb25zdCBhc3Npc3RhbnRNZXNzYWdlID1cbiAgICAgIHR5cGVvZiBwYXJzZWQuYXNzaXN0YW50TWVzc2FnZSA9PT0gXCJzdHJpbmdcIiAmJiBwYXJzZWQuYXNzaXN0YW50TWVzc2FnZS50cmltKClcbiAgICAgICAgPyBwYXJzZWQuYXNzaXN0YW50TWVzc2FnZS50cmltKClcbiAgICAgICAgOiBcIlVwZGF0ZWQgcHJvamVjdCBmaWxlcy5cIjtcblxuICAgIHJldHVybiB7IG9rOiB0cnVlLCBhc3Npc3RhbnRNZXNzYWdlLCBmaWxlcyB9O1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICByZXR1cm4geyBvazogZmFsc2UsIHJlYXNvbjogZT8ubWVzc2FnZSB8fCBcIkJ1aWxkZXIgZXJyb3JcIiB9O1xuICB9XG59XG4iXSwibmFtZXMiOlsiT3BlbkFJIiwic2FmZVBhcnNlSlNPTiIsInJhdyIsInMiLCJ0cmltIiwiSlNPTiIsInBhcnNlIiwic3RhcnQiLCJpbmRleE9mIiwiZW5kIiwibGFzdEluZGV4T2YiLCJjYW5kaWRhdGUiLCJzbGljZSIsIm5vcm1hbGl6ZUZpbGVzIiwiZmlsZXMiLCJBcnJheSIsImlzQXJyYXkiLCJvdXQiLCJmIiwicmF3UGF0aCIsInBhdGgiLCJjb250ZW50Iiwic2FmZVBhdGgiLCJyZXBsYWNlIiwibGVuZ3RoIiwicHVzaCIsImJ5UGF0aCIsIk1hcCIsInNldCIsImZyb20iLCJ2YWx1ZXMiLCJnZW5lcmF0ZUZpbGVzIiwiYXJncyIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsIm9rIiwicmVhc29uIiwib3BlbmFpIiwiY3R4IiwiY29udGV4dCIsImV4aXN0aW5nIiwiZXhpc3RpbmdGaWxlcyIsInN5c3RlbSIsInVzZXIiLCJ1c2VyTWVzc2FnZSIsImJ1aWxkSW5mbyIsInN0cmluZ2lmeSIsIm1hcCIsImpvaW4iLCJtIiwicm9sZSIsInRvVXBwZXJDYXNlIiwidGV4dCIsImluc3RydWN0aW9ucyIsImNvbXBsZXRpb24iLCJjaGF0IiwiY29tcGxldGlvbnMiLCJjcmVhdGUiLCJtb2RlbCIsInJlc3BvbnNlX2Zvcm1hdCIsInR5cGUiLCJ0ZW1wZXJhdHVyZSIsIm1lc3NhZ2VzIiwiY2hvaWNlcyIsIm1lc3NhZ2UiLCJwYXJzZWQiLCJhc3Npc3RhbnRNZXNzYWdlIiwiZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/ai/generateFiles.ts\n");

/***/ }),

/***/ "(rsc)/./lib/sandbox/chatStore.ts":
/*!**********************************!*\
  !*** ./lib/sandbox/chatStore.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   appendChat: () => (/* binding */ appendChat),\n/* harmony export */   readChat: () => (/* binding */ readChat)\n/* harmony export */ });\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! server-only */ \"(rsc)/./node_modules/next/dist/compiled/server-only/empty.js\");\n/* harmony import */ var server_only__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(server_only__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_sandbox_paths__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/sandbox/paths */ \"(rsc)/./lib/sandbox/paths.ts\");\n\n\n\n\nfunction chatFile(projectId) {\n    return path__WEBPACK_IMPORTED_MODULE_2___default().join((0,_lib_sandbox_paths__WEBPACK_IMPORTED_MODULE_3__.projectRoot)(projectId), \"chat.json\");\n}\n// Read chat history for a project. Keep it short so prompts stay stable.\nfunction readChat(projectId, limit = 24) {\n    try {\n        const fp = chatFile(projectId);\n        if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(fp)) return [];\n        const raw = fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(fp, \"utf8\");\n        const parsed = JSON.parse(raw);\n        if (!Array.isArray(parsed)) return [];\n        const clipped = parsed.slice(-limit).map((t)=>({\n                role: t.role,\n                content: String(t.content || \"\").slice(0, 2000)\n            }));\n        return clipped;\n    } catch  {\n        return [];\n    }\n}\nfunction appendChat(projectId, turn) {\n    try {\n        const fp = chatFile(projectId);\n        fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(path__WEBPACK_IMPORTED_MODULE_2___default().dirname(fp), {\n            recursive: true\n        });\n        const existing = (()=>{\n            try {\n                if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(fp)) return [];\n                const raw = fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(fp, \"utf8\");\n                const j = JSON.parse(raw);\n                return Array.isArray(j) ? j : [];\n            } catch  {\n                return [];\n            }\n        })();\n        existing.push({\n            ...turn,\n            at: new Date().toISOString()\n        });\n        // Hard cap\n        const capped = existing.slice(-80);\n        fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(fp, JSON.stringify(capped, null, 2), \"utf8\");\n    } catch  {\n    // ignore\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2FuZGJveC9jaGF0U3RvcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXFCO0FBQ0Q7QUFDSTtBQUMwQjtBQUlsRCxTQUFTRyxTQUFTQyxTQUFpQjtJQUNqQyxPQUFPSCxnREFBUyxDQUFDQywrREFBV0EsQ0FBQ0UsWUFBWTtBQUMzQztBQUVBLHlFQUF5RTtBQUNsRSxTQUFTRSxTQUFTRixTQUFpQixFQUFFRyxRQUFRLEVBQUU7SUFDcEQsSUFBSTtRQUNGLE1BQU1DLEtBQUtMLFNBQVNDO1FBQ3BCLElBQUksQ0FBQ0osb0RBQWEsQ0FBQ1EsS0FBSyxPQUFPLEVBQUU7UUFDakMsTUFBTUUsTUFBTVYsc0RBQWUsQ0FBQ1EsSUFBSTtRQUNoQyxNQUFNSSxTQUFTQyxLQUFLQyxLQUFLLENBQUNKO1FBQzFCLElBQUksQ0FBQ0ssTUFBTUMsT0FBTyxDQUFDSixTQUFTLE9BQU8sRUFBRTtRQUNyQyxNQUFNSyxVQUFVTCxPQUFPTSxLQUFLLENBQUMsQ0FBQ1gsT0FBT1ksR0FBRyxDQUFDLENBQUNDLElBQU87Z0JBQy9DQyxNQUFNRCxFQUFFQyxJQUFJO2dCQUNaQyxTQUFTQyxPQUFPSCxFQUFFRSxPQUFPLElBQUksSUFBSUosS0FBSyxDQUFDLEdBQUc7WUFDNUM7UUFDQSxPQUFPRDtJQUNULEVBQUUsT0FBTTtRQUNOLE9BQU8sRUFBRTtJQUNYO0FBQ0Y7QUFFTyxTQUFTTyxXQUFXcEIsU0FBaUIsRUFBRXFCLElBQWM7SUFDMUQsSUFBSTtRQUNGLE1BQU1qQixLQUFLTCxTQUFTQztRQUNwQkosbURBQVksQ0FBQ0MsbURBQVksQ0FBQ08sS0FBSztZQUFFb0IsV0FBVztRQUFLO1FBRWpELE1BQU1DLFdBQXVCLENBQUM7WUFDNUIsSUFBSTtnQkFDRixJQUFJLENBQUM3QixvREFBYSxDQUFDUSxLQUFLLE9BQU8sRUFBRTtnQkFDakMsTUFBTUUsTUFBTVYsc0RBQWUsQ0FBQ1EsSUFBSTtnQkFDaEMsTUFBTXNCLElBQUlqQixLQUFLQyxLQUFLLENBQUNKO2dCQUNyQixPQUFPSyxNQUFNQyxPQUFPLENBQUNjLEtBQU1BLElBQW1CLEVBQUU7WUFDbEQsRUFBRSxPQUFNO2dCQUNOLE9BQU8sRUFBRTtZQUNYO1FBQ0Y7UUFFQUQsU0FBU0UsSUFBSSxDQUFDO1lBQUUsR0FBR04sSUFBSTtZQUFFTyxJQUFJLElBQUlDLE9BQU9DLFdBQVc7UUFBRztRQUV0RCxXQUFXO1FBQ1gsTUFBTUMsU0FBU04sU0FBU1gsS0FBSyxDQUFDLENBQUM7UUFFL0JsQix1REFBZ0IsQ0FBQ1EsSUFBSUssS0FBS3dCLFNBQVMsQ0FBQ0YsUUFBUSxNQUFNLElBQUk7SUFDeEQsRUFBRSxPQUFNO0lBQ04sU0FBUztJQUNYO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uaWNvbGxvLXYxLy4vbGliL3NhbmRib3gvY2hhdFN0b3JlLnRzP2MwNjAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFwic2VydmVyLW9ubHlcIjtcbmltcG9ydCBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgeyBwcm9qZWN0Um9vdCB9IGZyb20gXCJAL2xpYi9zYW5kYm94L3BhdGhzXCI7XG5cbmV4cG9ydCB0eXBlIENoYXRUdXJuID0geyByb2xlOiBcInVzZXJcIiB8IFwiYXNzaXN0YW50XCI7IGNvbnRlbnQ6IHN0cmluZzsgYXQ/OiBzdHJpbmcgfTtcblxuZnVuY3Rpb24gY2hhdEZpbGUocHJvamVjdElkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHBhdGguam9pbihwcm9qZWN0Um9vdChwcm9qZWN0SWQpLCBcImNoYXQuanNvblwiKTtcbn1cblxuLy8gUmVhZCBjaGF0IGhpc3RvcnkgZm9yIGEgcHJvamVjdC4gS2VlcCBpdCBzaG9ydCBzbyBwcm9tcHRzIHN0YXkgc3RhYmxlLlxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRDaGF0KHByb2plY3RJZDogc3RyaW5nLCBsaW1pdCA9IDI0KTogQXJyYXk8eyByb2xlOiBzdHJpbmc7IGNvbnRlbnQ6IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZnAgPSBjaGF0RmlsZShwcm9qZWN0SWQpO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhmcCkpIHJldHVybiBbXTtcbiAgICBjb25zdCByYXcgPSBmcy5yZWFkRmlsZVN5bmMoZnAsIFwidXRmOFwiKTtcbiAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHJhdykgYXMgQ2hhdFR1cm5bXTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkocGFyc2VkKSkgcmV0dXJuIFtdO1xuICAgIGNvbnN0IGNsaXBwZWQgPSBwYXJzZWQuc2xpY2UoLWxpbWl0KS5tYXAoKHQpID0+ICh7XG4gICAgICByb2xlOiB0LnJvbGUsXG4gICAgICBjb250ZW50OiBTdHJpbmcodC5jb250ZW50IHx8IFwiXCIpLnNsaWNlKDAsIDIwMDApLFxuICAgIH0pKTtcbiAgICByZXR1cm4gY2xpcHBlZDtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBlbmRDaGF0KHByb2plY3RJZDogc3RyaW5nLCB0dXJuOiBDaGF0VHVybikge1xuICB0cnkge1xuICAgIGNvbnN0IGZwID0gY2hhdEZpbGUocHJvamVjdElkKTtcbiAgICBmcy5ta2RpclN5bmMocGF0aC5kaXJuYW1lKGZwKSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG5cbiAgICBjb25zdCBleGlzdGluZzogQ2hhdFR1cm5bXSA9ICgoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZnApKSByZXR1cm4gW107XG4gICAgICAgIGNvbnN0IHJhdyA9IGZzLnJlYWRGaWxlU3luYyhmcCwgXCJ1dGY4XCIpO1xuICAgICAgICBjb25zdCBqID0gSlNPTi5wYXJzZShyYXcpO1xuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShqKSA/IChqIGFzIENoYXRUdXJuW10pIDogW107XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgIH0pKCk7XG5cbiAgICBleGlzdGluZy5wdXNoKHsgLi4udHVybiwgYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KTtcblxuICAgIC8vIEhhcmQgY2FwXG4gICAgY29uc3QgY2FwcGVkID0gZXhpc3Rpbmcuc2xpY2UoLTgwKTtcblxuICAgIGZzLndyaXRlRmlsZVN5bmMoZnAsIEpTT04uc3RyaW5naWZ5KGNhcHBlZCwgbnVsbCwgMiksIFwidXRmOFwiKTtcbiAgfSBjYXRjaCB7XG4gICAgLy8gaWdub3JlXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJwcm9qZWN0Um9vdCIsImNoYXRGaWxlIiwicHJvamVjdElkIiwiam9pbiIsInJlYWRDaGF0IiwibGltaXQiLCJmcCIsImV4aXN0c1N5bmMiLCJyYXciLCJyZWFkRmlsZVN5bmMiLCJwYXJzZWQiLCJKU09OIiwicGFyc2UiLCJBcnJheSIsImlzQXJyYXkiLCJjbGlwcGVkIiwic2xpY2UiLCJtYXAiLCJ0Iiwicm9sZSIsImNvbnRlbnQiLCJTdHJpbmciLCJhcHBlbmRDaGF0IiwidHVybiIsIm1rZGlyU3luYyIsImRpcm5hbWUiLCJyZWN1cnNpdmUiLCJleGlzdGluZyIsImoiLCJwdXNoIiwiYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJjYXBwZWQiLCJ3cml0ZUZpbGVTeW5jIiwic3RyaW5naWZ5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/sandbox/chatStore.ts\n");

/***/ }),

/***/ "(rsc)/./lib/sandbox/fs.ts":
/*!***************************!*\
  !*** ./lib/sandbox/fs.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   listFiles: () => (/* binding */ listFiles),\n/* harmony export */   readFile: () => (/* binding */ readFile),\n/* harmony export */   readFilesSnapshot: () => (/* binding */ readFilesSnapshot),\n/* harmony export */   writeFiles: () => (/* binding */ writeFiles)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_sandbox_paths__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/sandbox/paths */ \"(rsc)/./lib/sandbox/paths.ts\");\n// lib/sandbox/fs.ts\n\n\n\nconst IGNORE_DIRS = new Set([\n    \"node_modules\",\n    \".next\",\n    \".git\",\n    \".turbo\",\n    \"dist\",\n    \"build\",\n    \".cache\"\n]);\nfunction safeResolve(base, target) {\n    // Prevent weird absolute paths / traversal\n    const clean = String(target || \"\").replace(/^([/\\\\])+/, \"\");\n    const resolved = path__WEBPACK_IMPORTED_MODULE_1___default().resolve(base, clean);\n    if (!resolved.startsWith(base)) {\n        throw new Error(`Invalid file path escape attempt: ${target}`);\n    }\n    return resolved;\n}\nfunction walkFiles(root) {\n    const out = [];\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(root)) return out;\n    const walk = (dir)=>{\n        for (const ent of fs__WEBPACK_IMPORTED_MODULE_0___default().readdirSync(dir, {\n            withFileTypes: true\n        })){\n            const full = path__WEBPACK_IMPORTED_MODULE_1___default().join(dir, ent.name);\n            if (ent.isDirectory()) {\n                if (IGNORE_DIRS.has(ent.name)) continue;\n                walk(full);\n            } else {\n                out.push(path__WEBPACK_IMPORTED_MODULE_1___default().relative(root, full));\n            }\n        }\n    };\n    walk(root);\n    return out;\n}\n/**\n * Writes file contents into the project sandbox folder.\n * - Creates folders as needed\n * - Overwrites existing files\n */ async function writeFiles(projectId, files) {\n    if (!Array.isArray(files)) {\n        throw new Error(\"writeFiles expects an array of files\");\n    }\n    (0,_lib_sandbox_paths__WEBPACK_IMPORTED_MODULE_2__.ensureDirs)(projectId);\n    const root = (0,_lib_sandbox_paths__WEBPACK_IMPORTED_MODULE_2__.currentDir)(projectId);\n    fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(root, {\n        recursive: true\n    });\n    for (const f of files){\n        if (!f || typeof f.path !== \"string\" || typeof f.content !== \"string\") {\n            throw new Error(\"Invalid file entry (expected { path: string, content: string })\");\n        }\n        const abs = safeResolve(root, f.path);\n        fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(path__WEBPACK_IMPORTED_MODULE_1___default().dirname(abs), {\n            recursive: true\n        });\n        fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(abs, f.content, \"utf8\");\n    }\n}\n/**\n * Lists all files currently present in the project's sandbox folder.\n */ function listFiles(projectId) {\n    const root = (0,_lib_sandbox_paths__WEBPACK_IMPORTED_MODULE_2__.currentDir)(projectId);\n    return walkFiles(root).sort();\n}\nfunction readFile(projectId, relPath) {\n    const root = (0,_lib_sandbox_paths__WEBPACK_IMPORTED_MODULE_2__.currentDir)(projectId);\n    const abs = safeResolve(root, relPath);\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(abs)) return null;\n    return fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(abs, \"utf8\");\n}\n/**\n * Reads a (path -> content) snapshot for the given list of paths.\n * Useful to feed the builder so it can iterate on existing code.\n */ function readFilesSnapshot(projectId, paths, maxCharsPerFile = 200000) {\n    const out = [];\n    for (const p of paths){\n        const c = readFile(projectId, p);\n        if (typeof c === \"string\") {\n            out.push({\n                path: p,\n                content: c.slice(0, maxCharsPerFile)\n            });\n        }\n    }\n    return out;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUM7Z0JBQUU3QixNQUFNbUQ7Z0JBQUdaLFNBQVNhLEVBQUVDLEtBQUssQ0FBQyxHQUFHSDtZQUFpQjtRQUMzRDtJQUNGO0lBQ0EsT0FBT2pDO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uaWNvbGxvLXYxLy4vbGliL3NhbmRib3gvZnMudHM/ZDNkZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvc2FuZGJveC9mcy50c1xuaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IGN1cnJlbnREaXIsIGVuc3VyZURpcnMgfSBmcm9tIFwiQC9saWIvc2FuZGJveC9wYXRoc1wiO1xuXG5jb25zdCBJR05PUkVfRElSUyA9IG5ldyBTZXQoW1xuICBcIm5vZGVfbW9kdWxlc1wiLFxuICBcIi5uZXh0XCIsXG4gIFwiLmdpdFwiLFxuICBcIi50dXJib1wiLFxuICBcImRpc3RcIixcbiAgXCJidWlsZFwiLFxuICBcIi5jYWNoZVwiLFxuXSk7XG5cblxuZXhwb3J0IHR5cGUgRmlsZVdyaXRlID0ge1xuICBwYXRoOiBzdHJpbmc7IC8vIHJlbGF0aXZlIHBhdGgsIGUuZy4gXCJpbmRleC5odG1sXCIgb3IgXCJzcmMvYXBwLmpzXCJcbiAgY29udGVudDogc3RyaW5nOyAvLyBmdWxsIGZpbGUgY29udGVudHNcbn07XG5cbmZ1bmN0aW9uIHNhZmVSZXNvbHZlKGJhc2U6IHN0cmluZywgdGFyZ2V0OiBzdHJpbmcpIHtcbiAgLy8gUHJldmVudCB3ZWlyZCBhYnNvbHV0ZSBwYXRocyAvIHRyYXZlcnNhbFxuICBjb25zdCBjbGVhbiA9IFN0cmluZyh0YXJnZXQgfHwgXCJcIikucmVwbGFjZSgvXihbL1xcXFxdKSsvLCBcIlwiKTtcbiAgY29uc3QgcmVzb2x2ZWQgPSBwYXRoLnJlc29sdmUoYmFzZSwgY2xlYW4pO1xuICBpZiAoIXJlc29sdmVkLnN0YXJ0c1dpdGgoYmFzZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZmlsZSBwYXRoIGVzY2FwZSBhdHRlbXB0OiAke3RhcmdldH1gKTtcbiAgfVxuICByZXR1cm4gcmVzb2x2ZWQ7XG59XG5cbmZ1bmN0aW9uIHdhbGtGaWxlcyhyb290OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIGNvbnN0IG91dDogc3RyaW5nW10gPSBbXTtcbiAgaWYgKCFmcy5leGlzdHNTeW5jKHJvb3QpKSByZXR1cm4gb3V0O1xuXG4gIGNvbnN0IHdhbGsgPSAoZGlyOiBzdHJpbmcpID0+IHtcbiAgICBmb3IgKGNvbnN0IGVudCBvZiBmcy5yZWFkZGlyU3luYyhkaXIsIHsgd2l0aEZpbGVUeXBlczogdHJ1ZSB9KSkge1xuICAgICAgY29uc3QgZnVsbCA9IHBhdGguam9pbihkaXIsIGVudC5uYW1lKTtcbiAgICAgIGlmIChlbnQuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICBpZiAoSUdOT1JFX0RJUlMuaGFzKGVudC5uYW1lKSkgY29udGludWU7XG4gICAgICAgIHdhbGsoZnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXQucHVzaChwYXRoLnJlbGF0aXZlKHJvb3QsIGZ1bGwpKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgd2Fsayhyb290KTtcbiAgcmV0dXJuIG91dDtcbn1cblxuLyoqXG4gKiBXcml0ZXMgZmlsZSBjb250ZW50cyBpbnRvIHRoZSBwcm9qZWN0IHNhbmRib3ggZm9sZGVyLlxuICogLSBDcmVhdGVzIGZvbGRlcnMgYXMgbmVlZGVkXG4gKiAtIE92ZXJ3cml0ZXMgZXhpc3RpbmcgZmlsZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdyaXRlRmlsZXMocHJvamVjdElkOiBzdHJpbmcsIGZpbGVzOiBGaWxlV3JpdGVbXSkge1xuICBpZiAoIUFycmF5LmlzQXJyYXkoZmlsZXMpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwid3JpdGVGaWxlcyBleHBlY3RzIGFuIGFycmF5IG9mIGZpbGVzXCIpO1xuICB9XG5cbiAgZW5zdXJlRGlycyhwcm9qZWN0SWQpO1xuICBjb25zdCByb290ID0gY3VycmVudERpcihwcm9qZWN0SWQpO1xuICBmcy5ta2RpclN5bmMocm9vdCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG5cbiAgZm9yIChjb25zdCBmIG9mIGZpbGVzKSB7XG4gICAgaWYgKCFmIHx8IHR5cGVvZiBmLnBhdGggIT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIGYuY29udGVudCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBmaWxlIGVudHJ5IChleHBlY3RlZCB7IHBhdGg6IHN0cmluZywgY29udGVudDogc3RyaW5nIH0pXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGFicyA9IHNhZmVSZXNvbHZlKHJvb3QsIGYucGF0aCk7XG4gICAgZnMubWtkaXJTeW5jKHBhdGguZGlybmFtZShhYnMpLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGFicywgZi5jb250ZW50LCBcInV0ZjhcIik7XG4gIH1cbn1cblxuLyoqXG4gKiBMaXN0cyBhbGwgZmlsZXMgY3VycmVudGx5IHByZXNlbnQgaW4gdGhlIHByb2plY3QncyBzYW5kYm94IGZvbGRlci5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxpc3RGaWxlcyhwcm9qZWN0SWQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgY29uc3Qgcm9vdCA9IGN1cnJlbnREaXIocHJvamVjdElkKTtcbiAgcmV0dXJuIHdhbGtGaWxlcyhyb290KS5zb3J0KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkRmlsZShwcm9qZWN0SWQ6IHN0cmluZywgcmVsUGF0aDogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gIGNvbnN0IHJvb3QgPSBjdXJyZW50RGlyKHByb2plY3RJZCk7XG4gIGNvbnN0IGFicyA9IHNhZmVSZXNvbHZlKHJvb3QsIHJlbFBhdGgpO1xuICBpZiAoIWZzLmV4aXN0c1N5bmMoYWJzKSkgcmV0dXJuIG51bGw7XG4gIHJldHVybiBmcy5yZWFkRmlsZVN5bmMoYWJzLCBcInV0ZjhcIik7XG59XG5cbi8qKlxuICogUmVhZHMgYSAocGF0aCAtPiBjb250ZW50KSBzbmFwc2hvdCBmb3IgdGhlIGdpdmVuIGxpc3Qgb2YgcGF0aHMuXG4gKiBVc2VmdWwgdG8gZmVlZCB0aGUgYnVpbGRlciBzbyBpdCBjYW4gaXRlcmF0ZSBvbiBleGlzdGluZyBjb2RlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZEZpbGVzU25hcHNob3QoXG4gIHByb2plY3RJZDogc3RyaW5nLFxuICBwYXRoczogc3RyaW5nW10sXG4gIG1heENoYXJzUGVyRmlsZSA9IDIwMF8wMDBcbik6IEFycmF5PHsgcGF0aDogc3RyaW5nOyBjb250ZW50OiBzdHJpbmcgfT4ge1xuICBjb25zdCBvdXQ6IEFycmF5PHsgcGF0aDogc3RyaW5nOyBjb250ZW50OiBzdHJpbmcgfT4gPSBbXTtcbiAgZm9yIChjb25zdCBwIG9mIHBhdGhzKSB7XG4gICAgY29uc3QgYyA9IHJlYWRGaWxlKHByb2plY3RJZCwgcCk7XG4gICAgaWYgKHR5cGVvZiBjID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBvdXQucHVzaCh7IHBhdGg6IHAsIGNvbnRlbnQ6IGMuc2xpY2UoMCwgbWF4Q2hhcnNQZXJGaWxlKSB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG91dDtcbn1cbiJdLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJjdXJyZW50RGlyIiwiZW5zdXJlRGlycyIsIklHTk9SRV9ESVJTIiwiU2V0Iiwic2FmZVJlc29sdmUiLCJiYXNlIiwidGFyZ2V0IiwiY2xlYW4iLCJTdHJpbmciLCJyZXBsYWNlIiwicmVzb2x2ZWQiLCJyZXNvbHZlIiwic3RhcnRzV2l0aCIsIkVycm9yIiwid2Fsa0ZpbGVzIiwicm9vdCIsIm91dCIsImV4aXN0c1N5bmMiLCJ3YWxrIiwiZGlyIiwiZW50IiwicmVhZGRpclN5bmMiLCJ3aXRoRmlsZVR5cGVzIiwiZnVsbCIsImpvaW4iLCJuYW1lIiwiaXNEaXJlY3RvcnkiLCJoYXMiLCJwdXNoIiwicmVsYXRpdmUiLCJ3cml0ZUZpbGVzIiwicHJvamVjdElkIiwiZmlsZXMiLCJBcnJheSIsImlzQXJyYXkiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJmIiwiY29udGVudCIsImFicyIsImRpcm5hbWUiLCJ3cml0ZUZpbGVTeW5jIiwibGlzdEZpbGVzIiwic29ydCIsInJlYWRGaWxlIiwicmVsUGF0aCIsInJlYWRGaWxlU3luYyIsInJlYWRGaWxlc1NuYXBzaG90IiwicGF0aHMiLCJtYXhDaGFyc1BlckZpbGUiLCJwIiwiYyIsInNsaWNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/sandbox/fs.ts\n");

/***/ }),

/***/ "(rsc)/./lib/sandbox/meta.ts":
/*!*****************************!*\
  !*** ./lib/sandbox/meta.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   readMeta: () => (/* binding */ readMeta),\n/* harmony export */   readProjectMeta: () => (/* binding */ readProjectMeta),\n/* harmony export */   writeMeta: () => (/* binding */ writeMeta),\n/* harmony export */   writeProjectMeta: () => (/* binding */ writeProjectMeta)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n// lib/sandbox/meta.ts\n\n\nfunction projectsRoot() {\n    return path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"sandbox\", \"projects\");\n}\nfunction projectDir(projectId) {\n    return path__WEBPACK_IMPORTED_MODULE_1___default().join(projectsRoot(), projectId);\n}\nfunction metaPath(projectId) {\n    return path__WEBPACK_IMPORTED_MODULE_1___default().join(projectDir(projectId), \"meta.json\");\n}\nfunction ensureProjectDir(projectId) {\n    const dir = projectDir(projectId);\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(dir)) fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(dir, {\n        recursive: true\n    });\n}\nfunction nowIso() {\n    return new Date().toISOString();\n}\nfunction readMeta(projectId) {\n    try {\n        const p = metaPath(projectId);\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(p)) return null;\n        const raw = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(p, \"utf-8\");\n        return JSON.parse(raw);\n    } catch  {\n        return null;\n    }\n}\nfunction writeMeta(projectId, patch) {\n    ensureProjectDir(projectId);\n    const prev = readMeta(projectId);\n    const base = prev ?? {\n        id: projectId,\n        createdAt: nowIso(),\n        updatedAt: nowIso()\n    };\n    const next = {\n        ...base,\n        ...patch,\n        id: projectId,\n        updatedAt: nowIso()\n    };\n    fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(metaPath(projectId), JSON.stringify(next, null, 2), \"utf-8\");\n    return next;\n}\nconst readProjectMeta = readMeta;\nconst writeProjectMeta = writeMeta;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2FuZGJveC9tZXRhLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsc0JBQXNCO0FBQ0Y7QUFDSTtBQXdDeEIsU0FBU0U7SUFDUCxPQUFPRCxnREFBUyxDQUFDRyxRQUFRQyxHQUFHLElBQUksV0FBVztBQUM3QztBQUVBLFNBQVNDLFdBQVdDLFNBQWlCO0lBQ25DLE9BQU9OLGdEQUFTLENBQUNDLGdCQUFnQks7QUFDbkM7QUFFQSxTQUFTQyxTQUFTRCxTQUFpQjtJQUNqQyxPQUFPTixnREFBUyxDQUFDSyxXQUFXQyxZQUFZO0FBQzFDO0FBRUEsU0FBU0UsaUJBQWlCRixTQUFpQjtJQUN6QyxNQUFNRyxNQUFNSixXQUFXQztJQUN2QixJQUFJLENBQUNQLG9EQUFhLENBQUNVLE1BQU1WLG1EQUFZLENBQUNVLEtBQUs7UUFBRUcsV0FBVztJQUFLO0FBQy9EO0FBRUEsU0FBU0M7SUFDUCxPQUFPLElBQUlDLE9BQU9DLFdBQVc7QUFDL0I7QUFFTyxTQUFTQyxTQUFTVixTQUFpQjtJQUN4QyxJQUFJO1FBQ0YsTUFBTVcsSUFBSVYsU0FBU0Q7UUFDbkIsSUFBSSxDQUFDUCxvREFBYSxDQUFDa0IsSUFBSSxPQUFPO1FBQzlCLE1BQU1DLE1BQU1uQixzREFBZSxDQUFDa0IsR0FBRztRQUMvQixPQUFPRyxLQUFLQyxLQUFLLENBQUNIO0lBQ3BCLEVBQUUsT0FBTTtRQUNOLE9BQU87SUFDVDtBQUNGO0FBRU8sU0FBU0ksVUFBVWhCLFNBQWlCLEVBQUVpQixLQUEyQjtJQUN0RWYsaUJBQWlCRjtJQUVqQixNQUFNa0IsT0FBT1IsU0FBU1Y7SUFDdEIsTUFBTW1CLE9BQW9CRCxRQUFRO1FBQ2hDRSxJQUFJcEI7UUFDSnFCLFdBQVdkO1FBQ1hlLFdBQVdmO0lBQ2I7SUFFQSxNQUFNZ0IsT0FBb0I7UUFDeEIsR0FBR0osSUFBSTtRQUNQLEdBQUdGLEtBQUs7UUFDUkcsSUFBSXBCO1FBQ0pzQixXQUFXZjtJQUNiO0lBRUFkLHVEQUFnQixDQUFDUSxTQUFTRCxZQUFZYyxLQUFLVyxTQUFTLENBQUNGLE1BQU0sTUFBTSxJQUFJO0lBQ3JFLE9BQU9BO0FBQ1Q7QUFFTyxNQUFNRyxrQkFBa0JoQixTQUFTO0FBQ2pDLE1BQU1pQixtQkFBbUJYLFVBQVUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uaWNvbGxvLXYxLy4vbGliL3NhbmRib3gvbWV0YS50cz81NmE5Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9zYW5kYm94L21ldGEudHNcbmltcG9ydCBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5cbmV4cG9ydCB0eXBlIFByb2plY3RNZXRhID0ge1xuICBpZDogc3RyaW5nO1xuICBjcmVhdGVkQXQ6IHN0cmluZztcbiAgdXBkYXRlZEF0OiBzdHJpbmc7XG5cbiAgdGl0bGU/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuXG4gIGVudHJ5Pzogc3RyaW5nO1xuICBmaWxlTGlzdD86IHN0cmluZ1tdO1xuICBsYXN0QnVpbGRBdD86IHN0cmluZztcbiAgbGFzdEJ1aWxkT2s/OiBib29sZWFuO1xuXG4gIGluaXRpYWxpemVkPzogYm9vbGVhbjtcbiAgYnVpbHQ/OiBib29sZWFuO1xuICB2ZXJzaW9uPzogbnVtYmVyO1xuICBmaWxlcz86IHN0cmluZ1tdO1xuXG4gIG1lbW9yeT86IHN0cmluZztcblxuICBwZW5kaW5nUGxhdGZvcm1Qcm9tcHQ/OiBzdHJpbmc7XG5cbiAgYnVpbGRJbmZvPzoge1xuICAgIHBsYXRmb3JtOiBcIndlYlwiIHwgXCJpb3NcIiB8IFwiYW5kcm9pZFwiIHwgXCJpb3NfYW5kcm9pZFwiO1xuICAgIGZyYW1ld29yazogXCJuZXh0anNcIiB8IFwic2hhcmVkX21vYmlsZVwiIHwgXCJzd2lmdFwiIHwgXCJrb3RsaW5cIjtcbiAgICBsYW5ndWFnZTogXCJqYXZhc2NyaXB0XCIgfCBcInR5cGVzY3JpcHRcIiB8IFwic3dpZnRcIiB8IFwia290bGluXCI7XG4gICAgYXBwTmFtZTogc3RyaW5nO1xuICAgIG9uZUxpbmVyOiBzdHJpbmc7XG4gICAgY29yZUZlYXR1cmVzOiBzdHJpbmdbXTtcbiAgfTtcblxuICAvLyDinIUgQWRkZWQ6IHByZXZpZXcgcnVudGltZSBpbmZvXG4gIHByZXZpZXc/OiB7XG4gICAgbmV4dFBvcnQ/OiBudW1iZXI7XG4gICAgbmV4dFN0YXJ0ZWRBdD86IG51bWJlcjtcbiAgfTtcbn07XG5cbmZ1bmN0aW9uIHByb2plY3RzUm9vdCgpIHtcbiAgcmV0dXJuIHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBcInNhbmRib3hcIiwgXCJwcm9qZWN0c1wiKTtcbn1cblxuZnVuY3Rpb24gcHJvamVjdERpcihwcm9qZWN0SWQ6IHN0cmluZykge1xuICByZXR1cm4gcGF0aC5qb2luKHByb2plY3RzUm9vdCgpLCBwcm9qZWN0SWQpO1xufVxuXG5mdW5jdGlvbiBtZXRhUGF0aChwcm9qZWN0SWQ6IHN0cmluZykge1xuICByZXR1cm4gcGF0aC5qb2luKHByb2plY3REaXIocHJvamVjdElkKSwgXCJtZXRhLmpzb25cIik7XG59XG5cbmZ1bmN0aW9uIGVuc3VyZVByb2plY3REaXIocHJvamVjdElkOiBzdHJpbmcpIHtcbiAgY29uc3QgZGlyID0gcHJvamVjdERpcihwcm9qZWN0SWQpO1xuICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyKSkgZnMubWtkaXJTeW5jKGRpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG59XG5cbmZ1bmN0aW9uIG5vd0lzbygpIHtcbiAgcmV0dXJuIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRNZXRhKHByb2plY3RJZDogc3RyaW5nKTogUHJvamVjdE1ldGEgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwID0gbWV0YVBhdGgocHJvamVjdElkKTtcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMocCkpIHJldHVybiBudWxsO1xuICAgIGNvbnN0IHJhdyA9IGZzLnJlYWRGaWxlU3luYyhwLCBcInV0Zi04XCIpO1xuICAgIHJldHVybiBKU09OLnBhcnNlKHJhdykgYXMgUHJvamVjdE1ldGE7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cml0ZU1ldGEocHJvamVjdElkOiBzdHJpbmcsIHBhdGNoOiBQYXJ0aWFsPFByb2plY3RNZXRhPik6IFByb2plY3RNZXRhIHtcbiAgZW5zdXJlUHJvamVjdERpcihwcm9qZWN0SWQpO1xuXG4gIGNvbnN0IHByZXYgPSByZWFkTWV0YShwcm9qZWN0SWQpO1xuICBjb25zdCBiYXNlOiBQcm9qZWN0TWV0YSA9IHByZXYgPz8ge1xuICAgIGlkOiBwcm9qZWN0SWQsXG4gICAgY3JlYXRlZEF0OiBub3dJc28oKSxcbiAgICB1cGRhdGVkQXQ6IG5vd0lzbygpLFxuICB9O1xuXG4gIGNvbnN0IG5leHQ6IFByb2plY3RNZXRhID0ge1xuICAgIC4uLmJhc2UsXG4gICAgLi4ucGF0Y2gsXG4gICAgaWQ6IHByb2plY3RJZCxcbiAgICB1cGRhdGVkQXQ6IG5vd0lzbygpLFxuICB9O1xuXG4gIGZzLndyaXRlRmlsZVN5bmMobWV0YVBhdGgocHJvamVjdElkKSwgSlNPTi5zdHJpbmdpZnkobmV4dCwgbnVsbCwgMiksIFwidXRmLThcIik7XG4gIHJldHVybiBuZXh0O1xufVxuXG5leHBvcnQgY29uc3QgcmVhZFByb2plY3RNZXRhID0gcmVhZE1ldGE7XG5leHBvcnQgY29uc3Qgd3JpdGVQcm9qZWN0TWV0YSA9IHdyaXRlTWV0YTtcbiJdLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJwcm9qZWN0c1Jvb3QiLCJqb2luIiwicHJvY2VzcyIsImN3ZCIsInByb2plY3REaXIiLCJwcm9qZWN0SWQiLCJtZXRhUGF0aCIsImVuc3VyZVByb2plY3REaXIiLCJkaXIiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwibm93SXNvIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwicmVhZE1ldGEiLCJwIiwicmF3IiwicmVhZEZpbGVTeW5jIiwiSlNPTiIsInBhcnNlIiwid3JpdGVNZXRhIiwicGF0Y2giLCJwcmV2IiwiYmFzZSIsImlkIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwibmV4dCIsIndyaXRlRmlsZVN5bmMiLCJzdHJpbmdpZnkiLCJyZWFkUHJvamVjdE1ldGEiLCJ3cml0ZVByb2plY3RNZXRhIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/sandbox/meta.ts\n");

/***/ }),

/***/ "(rsc)/./lib/sandbox/paths.ts":
/*!******************************!*\
  !*** ./lib/sandbox/paths.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   currentDir: () => (/* binding */ currentDir),\n/* harmony export */   ensureDirs: () => (/* binding */ ensureDirs),\n/* harmony export */   projectRoot: () => (/* binding */ projectRoot),\n/* harmony export */   stagingDir: () => (/* binding */ stagingDir),\n/* harmony export */   templateDir: () => (/* binding */ templateDir),\n/* harmony export */   versionsDir: () => (/* binding */ versionsDir)\n/* harmony export */ });\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n\n\nfunction projectRoot(projectId) {\n    return path__WEBPACK_IMPORTED_MODULE_0___default().join(process.cwd(), \"sandbox\", \"projects\", projectId);\n}\nfunction currentDir(projectId) {\n    return path__WEBPACK_IMPORTED_MODULE_0___default().join(projectRoot(projectId), \"current\");\n}\nfunction versionsDir(projectId) {\n    return path__WEBPACK_IMPORTED_MODULE_0___default().join(projectRoot(projectId), \"versions\");\n}\nfunction stagingDir(projectId) {\n    return path__WEBPACK_IMPORTED_MODULE_0___default().join(projectRoot(projectId), \"staging\");\n}\nfunction templateDir(projectId) {\n    return path__WEBPACK_IMPORTED_MODULE_0___default().join(projectRoot(projectId), \"template\");\n}\nfunction ensureDirs(projectId) {\n    const root = projectRoot(projectId);\n    const cur = currentDir(projectId);\n    const vers = versionsDir(projectId);\n    const staging = stagingDir(projectId);\n    const tmpl = templateDir(projectId);\n    if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(root)) fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(root, {\n        recursive: true\n    });\n    if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(cur)) fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(cur, {\n        recursive: true\n    });\n    if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(tmpl)) fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(tmpl, {\n        recursive: true\n    });\n    if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(vers)) fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(vers, {\n        recursive: true\n    });\n    if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(staging)) fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(staging, {\n        recursive: true\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2FuZGJveC9wYXRocy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQXdCO0FBQ0o7QUFFYixTQUFTRSxZQUFZQyxTQUFpQjtJQUMzQyxPQUFPSCxnREFBUyxDQUFDSyxRQUFRQyxHQUFHLElBQUksV0FBVyxZQUFZSDtBQUN6RDtBQUNPLFNBQVNJLFdBQVdKLFNBQWlCO0lBQzFDLE9BQU9ILGdEQUFTLENBQUNFLFlBQVlDLFlBQVk7QUFDM0M7QUFDTyxTQUFTSyxZQUFZTCxTQUFpQjtJQUMzQyxPQUFPSCxnREFBUyxDQUFDRSxZQUFZQyxZQUFZO0FBQzNDO0FBQ08sU0FBU00sV0FBV04sU0FBaUI7SUFDMUMsT0FBT0gsZ0RBQVMsQ0FBQ0UsWUFBWUMsWUFBWTtBQUMzQztBQUVPLFNBQVNPLFlBQVlQLFNBQWlCO0lBQzNDLE9BQU9ILGdEQUFTLENBQUNFLFlBQVlDLFlBQVk7QUFDM0M7QUFFTyxTQUFTUSxXQUFXUixTQUFpQjtJQUMxQyxNQUFNUyxPQUFPVixZQUFZQztJQUN6QixNQUFNVSxNQUFNTixXQUFXSjtJQUN2QixNQUFNVyxPQUFPTixZQUFZTDtJQUN6QixNQUFNWSxVQUFVTixXQUFXTjtJQUMzQixNQUFNYSxPQUFPTixZQUFZUDtJQUN6QixJQUFJLENBQUNGLG9EQUFhLENBQUNXLE9BQU9YLG1EQUFZLENBQUNXLE1BQU07UUFBRU8sV0FBVztJQUFLO0lBQy9ELElBQUksQ0FBQ2xCLG9EQUFhLENBQUNZLE1BQU1aLG1EQUFZLENBQUNZLEtBQUs7UUFBRU0sV0FBVztJQUFLO0lBQzdELElBQUksQ0FBQ2xCLG9EQUFhLENBQUNlLE9BQU9mLG1EQUFZLENBQUNlLE1BQU07UUFBRUcsV0FBVztJQUFLO0lBQy9ELElBQUksQ0FBQ2xCLG9EQUFhLENBQUNhLE9BQU9iLG1EQUFZLENBQUNhLE1BQU07UUFBRUssV0FBVztJQUFLO0lBQy9ELElBQUksQ0FBQ2xCLG9EQUFhLENBQUNjLFVBQVVkLG1EQUFZLENBQUNjLFNBQVM7UUFBRUksV0FBVztJQUFLO0FBQ3ZFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmljb2xsby12MS8uL2xpYi9zYW5kYm94L3BhdGhzLnRzPzRhM2MiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCBmcyBmcm9tIFwiZnNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIHByb2plY3RSb290KHByb2plY3RJZDogc3RyaW5nKSB7XG4gIHJldHVybiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgXCJzYW5kYm94XCIsIFwicHJvamVjdHNcIiwgcHJvamVjdElkKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjdXJyZW50RGlyKHByb2plY3RJZDogc3RyaW5nKSB7XG4gIHJldHVybiBwYXRoLmpvaW4ocHJvamVjdFJvb3QocHJvamVjdElkKSwgXCJjdXJyZW50XCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHZlcnNpb25zRGlyKHByb2plY3RJZDogc3RyaW5nKSB7XG4gIHJldHVybiBwYXRoLmpvaW4ocHJvamVjdFJvb3QocHJvamVjdElkKSwgXCJ2ZXJzaW9uc1wiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdGFnaW5nRGlyKHByb2plY3RJZDogc3RyaW5nKSB7XG4gIHJldHVybiBwYXRoLmpvaW4ocHJvamVjdFJvb3QocHJvamVjdElkKSwgXCJzdGFnaW5nXCIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdGVtcGxhdGVEaXIocHJvamVjdElkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHBhdGguam9pbihwcm9qZWN0Um9vdChwcm9qZWN0SWQpLCBcInRlbXBsYXRlXCIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5zdXJlRGlycyhwcm9qZWN0SWQ6IHN0cmluZykge1xuICBjb25zdCByb290ID0gcHJvamVjdFJvb3QocHJvamVjdElkKTtcbiAgY29uc3QgY3VyID0gY3VycmVudERpcihwcm9qZWN0SWQpO1xuICBjb25zdCB2ZXJzID0gdmVyc2lvbnNEaXIocHJvamVjdElkKTtcbiAgY29uc3Qgc3RhZ2luZyA9IHN0YWdpbmdEaXIocHJvamVjdElkKTtcbiAgY29uc3QgdG1wbCA9IHRlbXBsYXRlRGlyKHByb2plY3RJZCk7XG4gIGlmICghZnMuZXhpc3RzU3luYyhyb290KSkgZnMubWtkaXJTeW5jKHJvb3QsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICBpZiAoIWZzLmV4aXN0c1N5bmMoY3VyKSkgZnMubWtkaXJTeW5jKGN1ciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gIGlmICghZnMuZXhpc3RzU3luYyh0bXBsKSkgZnMubWtkaXJTeW5jKHRtcGwsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICBpZiAoIWZzLmV4aXN0c1N5bmModmVycykpIGZzLm1rZGlyU3luYyh2ZXJzLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgaWYgKCFmcy5leGlzdHNTeW5jKHN0YWdpbmcpKSBmcy5ta2RpclN5bmMoc3RhZ2luZywgeyByZWN1cnNpdmU6IHRydWUgfSk7XG59XG4iXSwibmFtZXMiOlsicGF0aCIsImZzIiwicHJvamVjdFJvb3QiLCJwcm9qZWN0SWQiLCJqb2luIiwicHJvY2VzcyIsImN3ZCIsImN1cnJlbnREaXIiLCJ2ZXJzaW9uc0RpciIsInN0YWdpbmdEaXIiLCJ0ZW1wbGF0ZURpciIsImVuc3VyZURpcnMiLCJyb290IiwiY3VyIiwidmVycyIsInN0YWdpbmciLCJ0bXBsIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/sandbox/paths.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/openai","vendor-chunks/form-data-encoder","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/ms","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute&page=%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproject%2F%5Bid%5D%2Fchat%2Froute.ts&appDir=%2FUsers%2Fadhiththyagarajan%2FDesktop%2FNicollo%2Fnicollo%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fadhiththyagarajan%2FDesktop%2FNicollo%2Fnicollo&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();